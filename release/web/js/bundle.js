var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();!function(){function t(e,i,n){function a(r,s){if(!i[r]){if(!e[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(o)return o(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var h=i[r]={exports:{}};e[r][0].call(h.exports,function(t){return a(e[r][1][t]||t)},h,h.exports,t,e,i,n)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)a(n[r]);return a}return t}()({1:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./script/BattleScene"),a=t("./script/GameUI"),o=t("./script/BattleUI"),r=t("./script/ImageBtn"),s=t("./script/SelectHeroUI"),l=function(){function t(){}return t.init=function(){var t=Laya.ClassUtils.regClass;t("script/BattleScene.ts",n.default),t("script/GameUI.ts",a.default),t("script/BattleUI.ts",o.default),t("script/ImageBtn.ts",r.default),t("script/SelectHeroUI.ts",s.default)},t.width=1136,t.height=640,t.scaleMode="fixedheight",t.screenMode="horizontal",t.alignV="middle",t.alignH="center",t.startScene="test/TestScene.scene",t.sceneRoot="",t.debug=!1,t.stat=!0,t.physicsDebug=!1,t.exportSceneToJson=!0,t}();i.default=l,l.init()},{"./script/BattleScene":50,"./script/BattleUI":51,"./script/GameUI":53,"./script/ImageBtn":54,"./script/SelectHeroUI":55}],2:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./GameConfig"),a=t("./manager/GameStateManager");new(function(){function t(){window.Laya3D?Laya3D.init(n.default.width,n.default.height):Laya.init(n.default.width,n.default.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=n.default.scaleMode,Laya.stage.screenMode=n.default.screenMode,Laya.stage.alignH=n.default.alignH,Laya.stage.alignV=n.default.alignV,Laya.URL.exportSceneToJson=n.default.exportSceneToJson,(n.default.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),n.default.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),n.default.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}return t.prototype.onVersionLoaded=function(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))},t.prototype.onConfigLoaded=function(){Laya.loader.load("res/atlas/bloodfont.atlas",Laya.Handler.create(this,this.startGame))},t.prototype.startGame=function(){a.GameStateManager.Instance=new a.GameStateManager,a.GameStateManager.Instance.changeGameState(1)},t}())},{"./GameConfig":1,"./manager/GameStateManager":49}],3:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./core/SceneManager"),a=t("./core/effect/EffectManager"),o=t("../data/GameTime"),r=t("./core/util/GameUtils"),s=t("./core/entity/EntityManager"),l=t("./battleState/BattleStateManager"),c=t("./core/SkillManager"),h=t("./core/fsm/EntityFreeFsm"),p=t("./core/entity/ai/AIManager"),f=t("./core/CameraManager"),u=t("../data/GameData"),d=t("../config/ConfigManager"),m=function(){function t(){this._renders=[],this._init=!1,this.battleing=!1}return t.prototype.init=function(t){this._init||(o.GameTime.createInstance(),this._gameTime=o.GameTime.Instance,this._gameTime.totalGameTime=0,this._gameTime.startTime=Date.now(),n.SceneManager.createInstance(),a.EffectManager.createInstance(),Laya.timer.frameLoop(1,this,this.enterFrame),this.state=new l.BattleStateManager,this.state.init(),this.skill=c.SkillManager.Instance,this.gameData=u.GameData.instance,n.SceneManager.Instance.init(t),Laya.stage.on(Laya.UIEvent.RESIZE,this,this.resizeHandler),this._init=!0),u.GameData.instance.turnId=0,n.SceneManager.Instance.enter()},t.prototype.nextLevel=function(){u.GameData.instance.turnId=0,n.SceneManager.Instance.enter()},t.prototype.resizeHandler=function(t){s.EntityManager.Instance.resize()},t.prototype.enterFrame=function(){var t=this._gameTime;t.update(),this.battleing&&(this.skill.updateTime(t),this.state.updateTime(t),n.SceneManager.Instance.updateTime(),s.EntityManager.Instance.update(t),a.EffectManager.Instance.updateTime(t));for(var e=0,i=this._renders;e<i.length;e++){var o=i[e];o.enabled&&o.updateTime(t)}},t.prototype.addUpdate=function(t){-1==this._renders.indexOf(t)&&this._renders.push(t)},t.prototype.removeUpdate=function(t){var e=this._renders.indexOf(t);e>-1&&this._renders.splice(e,1)},t.prototype.addPlayer=function(){var t=s.EntityManager.Instance.createPlayer();t.a_bornX=t.gridX=-20.7,t.a_bornZ=t.gridY=22.7,t.x=-20.7,t.y=0,t.z=22.7,t.a_name="测试玩家",s.EntityManager.Instance.firstPlayer=t,t.changeFSMState(h.EntityFreeFsm.Instance),t._entityAI=p.AIManager.Instance.getAI(0),t.a_weaponModel=20001,t.a_clothModel=1,t.a_maxHp=t.a_truehp=t.a_delayhp=u.GameData.instance.hp,t.createComponents(),t.addToView(),t.checkInfoInview(),t.model3D.transform.rotate(new Laya.Vector3(0,-90,0)),f.CameraManager.Instance.mainCamera.transform.position=new Laya.Vector3(t.x,t.y+18,t.z-12),f.CameraManager.Instance.mainCamera.transform.lookAt(t.model3D.transform.position,r.GameUtils.Vector3UpTemp),f.CameraManager.Instance.mainCamera.transform.translate(new Laya.Vector3(3,0,0)),t._entityInfo.updatePos(t.model3D.transform.position)},t.prototype.startGame=function(){var t=[{id:r.IDProvider.getEntityInsID(),mid:40001},{id:r.IDProvider.getEntityInsID(),mid:40002},{id:r.IDProvider.getEntityInsID(),mid:40003},{id:r.IDProvider.getEntityInsID(),mid:40004},{id:r.IDProvider.getEntityInsID(),mid:40005}];this.addPlayer(),this.addEnemys(t),u.GameData.instance.oppQueue=t,this.battleing=!0,this.state.changeGameState(1)},t.prototype.addEnemys=function(t){for(var e=[[[0,0]],[[0,-1],[0,1]],[[0,0],[1,-1],[1,1]],[[0,-1],[0,1],[1,2],[1,-2]],[[0,0],[0,-2],[0,2],[1,-1],[1,1]]][t.length-1],i=0;i<e.length;i++){var n=e[i],a=s.EntityManager.Instance.createEnemy(t[i].id);a.config=d.ConfigManager.Instance.monster[t[i].mid],a.mid=t[i].mid,a.a_bornX=a.gridX=-26.7-n[0],a.a_bornZ=a.gridY=22.7-n[1],a.x=-26.7-n[0],a.y=0,a.z=22.7-n[1],a.a_name=a.config.name,a.changeFSMState(h.EntityFreeFsm.Instance),a._entityAI=p.AIManager.Instance.getAI(1),a.a_weaponModel=20001,a.a_clothModel=3+Math.floor(4*Math.random()),a.a_maxHp=a.a_truehp=a.a_delayhp=12,a.createComponents(),a.addToView(),a.checkInfoInview(),a.model3D.transform.rotate(new Laya.Vector3(0,90,0)),a._entityInfo.updatePos(a.model3D.transform.position)}},t.prototype.useCard=function(t){var e=u.GameData.instance;if(e.selectedCard&&t){if(e.mp<e.selectedCard.config.mp)return void e.sendNotif(7,"法力不足");var i=u.GameData.instance.selectedCard,n=s.EntityManager.Instance.firstPlayer;n.entityAI.doSkill(n,t,i.config.skill,i.level)&&(e.mp-=i.config.mp,u.GameData.instance.useHandCard(i.id))}},t.prototype.startTurn=function(){this.gameData.myTurn?this.state.changeGameState(2):this.state.changeGameState(3)},t.prototype.endMyTurn=function(){2==this.state.curState.gameState()&&this.state.changeGameState(6)},t.prototype.enemyStateClear=function(){for(var t=0,e=u.GameData.instance.oppQueue;t<e.length;t++){var i=e[t];if(i.id){s.EntityManager.Instance._enemyDic[i.id].a_state=0}}},t.prototype.enemyAction=function(){for(var t=0,e=u.GameData.instance.oppQueue;t<e.length;t++){var i=e[t];if(i.id){var n=s.EntityManager.Instance._enemyDic[i.id];if(n.a_isDead)continue;if(0==n.a_state)return n.a_state=1,n.entityAI.doSomething(n,s.EntityManager.Instance.firstPlayer),!0;if(1==n.a_state){if(0!=n.curFsm.getState())return!0;n.a_state=2}}}return!1},t.prototype.checkEnemyState=function(){var t=s.EntityManager.Instance.getAllEnemy();for(var e in t){if(!t[e].a_isDead)return}u.GameData.instance.win(),this.state.changeGameState(7)},t.prototype.destroyScene=function(){u.GameData.instance.clearLevel(),c.SkillManager.Instance.cleanSkill(),s.EntityManager.Instance.destoryAllEntity(),a.EffectManager.Instance.destoryAllEffect(),n.SceneManager.Instance.destroyScene(),this.battleing=!1},t.Instance=new t,t}();i.BattleManager=m},{"../config/ConfigManager":46,"../data/GameData":47,"../data/GameTime":48,"./battleState/BattleStateManager":8,"./core/CameraManager":13,"./core/SceneManager":15,"./core/SkillManager":17,"./core/effect/EffectManager":18,"./core/entity/EntityManager":23,"./core/entity/ai/AIManager":28,"./core/fsm/EntityFreeFsm":33,"./core/util/GameUtils":44}],4:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../data/GameData"),a=function(){function t(){this._stateTo=0}return t.prototype.gameState=function(){return 7},t.prototype.enter=function(){n.GameData.instance.sendNotif(0,7)},t.prototype.updateTime=function(t){},t.prototype.exit=function(){},t}();i.default=a},{"../../data/GameData":47}],5:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../data/GameData"),a=function(){function t(){this._stateTo=0}return t.prototype.gameState=function(){return 2},t.prototype.enter=function(){n.GameData.instance.mp=3,n.GameData.instance.drawCards(),n.GameData.instance.sendNotif(0,2)},t.prototype.updateTime=function(t){},t.prototype.exit=function(){},t}();i.default=a},{"../../data/GameData":47}],6:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../data/GameData"),a=t("../BattleManager"),o=function(){function t(){this._stateTo=0}return t.prototype.gameState=function(){return 3},t.prototype.enter=function(){var t=n.GameData.instance;t.sendNotif(0,3),t.oppState=0},t.prototype.updateTime=function(t){if(n.GameData.instance.oppQueue){a.BattleManager.Instance.enemyAction()||a.BattleManager.Instance.state.changeGameState(6)}},t.prototype.exit=function(){},t}();i.default=o},{"../../data/GameData":47,"../BattleManager":3}],7:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../data/GameData"),a=t("../BattleManager"),o=function(){function t(){this._stateTo=0}return t.prototype.gameState=function(){return 1},t.prototype.enter=function(){var t=n.GameData.instance;t.sendNotif(0,1),t.prepareCardPile(),t.myTurn=!0},t.prototype.updateTime=function(t){a.BattleManager.Instance.state.changeGameState(4)},t.prototype.exit=function(){},t}();i.default=o},{"../../data/GameData":47,"../BattleManager":3}],8:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./BattleReadyState"),a=t("./BattleMyTurnState"),o=t("./BattleOppTurnState"),r=t("./BattleEndState"),s=t("./BattleWaitState"),l=t("./BattleTurnStartState"),c=t("./BattleTurnEndState"),h=function(){function t(){this._gameStates={}}return t.prototype.init=function(){var t=new n.default;this._gameStates[1]=t,t=new a.default,this._gameStates[2]=t,t=new o.default,this._gameStates[3]=t,t=new l.default,this._gameStates[4]=t,t=new c.default,this._gameStates[5]=t,t=new r.default,this._gameStates[7]=t,t=new s.default,this._gameStates[6]=t},Object.defineProperty(t.prototype,"curState",{get:function(){return this._currentState},enumerable:!0,configurable:!0}),t.prototype.changeGameState=function(t){null!=this._currentState&&this._currentState.gameState()==t||null!=this._gameStates[t]&&(null!=this._currentState&&this._currentState.exit(),this._currentState=this._gameStates[t],this._currentState.enter())},t.prototype.updateTime=function(t){null!=this._currentState&&this._currentState.updateTime(t)},t.prototype.getState=function(t){return this._gameStates[t]},t}();i.BattleStateManager=h},{"./BattleEndState":4,"./BattleMyTurnState":5,"./BattleOppTurnState":6,"./BattleReadyState":7,"./BattleTurnEndState":9,"./BattleTurnStartState":10,"./BattleWaitState":11}],9:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../data/GameData"),a=t("../BattleManager"),o=t("../core/BuffManager"),r=function(){function t(){this._stateTo=0}return t.prototype.gameState=function(){return 5},t.prototype.enter=function(){n.GameData.instance.sendNotif(0,5),n.GameData.instance.selectedCard=null,n.GameData.instance.dropCards(),o.BuffManager.Instance.turnEnd(n.GameData.instance.turnId)},t.prototype.updateTime=function(t){n.GameData.instance.myTurn=!n.GameData.instance.myTurn,a.BattleManager.Instance.enemyStateClear(),a.BattleManager.Instance.state.changeGameState(4)},t.prototype.exit=function(){},t}();i.default=r},{"../../data/GameData":47,"../BattleManager":3,"../core/BuffManager":12}],10:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../data/GameData"),a=t("../BattleManager"),o=t("../core/BuffManager"),r=function(){function t(){this._stateTo=0}return t.prototype.gameState=function(){return 4},t.prototype.enter=function(){n.GameData.instance.turnId++,n.GameData.instance.sendNotif(0,4),o.BuffManager.Instance.turnBegin(n.GameData.instance.turnId)},t.prototype.updateTime=function(t){a.BattleManager.Instance.startTurn()},t.prototype.exit=function(){},t}();i.default=r},{"../../data/GameData":47,"../BattleManager":3,"../core/BuffManager":12}],11:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../data/GameData"),a=t("../BattleManager"),o=t("../core/SkillManager"),r=function(){function t(){this._stateTo=0}return t.prototype.gameState=function(){return 6},t.prototype.enter=function(){n.GameData.instance.sendNotif(0,6)},t.prototype.updateTime=function(t){o.SkillManager.Instance.empty&&(n.GameData.instance._gameOver?(n.GameData.instance.sendNotif(8),a.BattleManager.Instance.state.changeGameState(7)):a.BattleManager.Instance.state.changeGameState(5))},t.prototype.exit=function(){},t}();i.default=r},{"../../data/GameData":47,"../BattleManager":3,"../core/SkillManager":17}],12:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../config/ConfigManager"),a=t("./effect/EffectManager"),o=t("./entity/EntityManager"),r=function(){function t(){this.enabled=!0,this._buffs={},this._nextUpdate=0}return Object.defineProperty(t,"Instance",{get:function(){return null!=this._instance&&void 0!=this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.addBuff=function(t,e,i){if(void 0===i&&(i=!1),t){var a=void 0;t.a_buffList||(t.a_buffList={}),a=e,t.a_buffList[a.id]=a;n.ConfigManager.Instance.buff[a.buffId];this._buffs[a.id]=a,i||t.display}},t.prototype.removeBuff=function(t,e){if(t&&t.a_buffList&&t.a_buffList[e]){var i=t.a_buffList[e];if(i.effects)for(var n=0,o=i.effects;n<o.length;n++){var r=o[n],s=a.EffectManager.Instance.getEffect(r);s&&s.die()}switch(i.buffType){case 1:i.param>0&&t&&(t.a_delayArmor=t.a_trueArmor=t.a_trueArmor-i.param)}delete t.a_buffList[e],this.check(t)}delete this._buffs[e]},t.prototype.check=function(t){if(t.display){var e=t.a_buffList;t.mabi=!1;for(var i in e){var a=e[i];n.ConfigManager.Instance.buff[a.buffId]}}},t.prototype.subArmor=function(t,e){var i=t.a_buffList;for(var n in i){var a=i[n];if(a.param>=e){a.param-=e;break}e-=a.param,a.param=0}},t.prototype.turnBegin=function(t){for(var e in this._buffs){var i=this._buffs[e];2==i.config.trigger&&this.buffCalculate(i,o.EntityManager.Instance.getEntity(i.entityId))}},t.prototype.turnEnd=function(t){for(var e in this._buffs){var i=this._buffs[e];i.endTime<=t?this.removeBuff(o.EntityManager.Instance.getEntity(i.entityId),i.id):1==i.config.trigger&&this.buffCalculate(i,o.EntityManager.Instance.getEntity(i.entityId))}},t.prototype.buffCalculate=function(t,e){switch(t.config.buffType){case 1:var i=Number(t.config.parameter);e.a_delayArmor=e.a_trueArmor=e.a_trueArmor+i,t.param=i}},t.prototype.clear=function(){this._buffs={}},t}();i.BuffManager=r;var s=function(){return function(){}}();i.BuffVO=s},{"../../config/ConfigManager":46,"./effect/EffectManager":18,"./entity/EntityManager":23}],13:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(){this.curHor=0,this.curVer=45,this.curDistance=20}return t.createInstance=function(){this.Instance=new t},t.prototype.moveCamera=function(t){this.move=t},t.Instance=new t,t}();i.CameraManager=n},{}],14:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(){}return t.MAP_GRID_WIDTH=72,t.MAP_GRID_HEIGHT=48,t.Effect_Wait_Time=200,t}();i.GameDefine=n;var a=function(){function t(){}return t.UP=4,t.RIGHT_UP=3,t.RIGHT=2,t.RIGHT_DOWN=1,t.DOWN=0,t.LEFT_DOWN=7,t.LEFT=6,t.LEFT_UP=5,t.NONE=0,t.EIGHT_MIRROR_DIRS=[0,1,2,3,4,3,2,1],t.EIGHT_FROM_TWO_DIRS=[1,1,1,3,3,3,1,1],t.FOUR_DIRS=[0,2,4,6],t.EIGHT_DIRS=[0,1,2,3,4,5,6,7],t}();i.DirectionType=a},{}],15:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./ShaderManager"),a=t("./CameraManager"),o=t("./entity/ai/AIManager"),r=t("../BattleManager"),s=t("./entity/EntityManager"),l=t("../../config/ConfigManager"),c=t("../../data/GameData"),h=t("./util/ResDisposer"),p=function(){function t(){this._mousePoint=new Laya.Vector2,this._hitresult=new Laya.HitResult,this._mouseRay=new Laya.Ray(new Laya.Vector3(0,0,0),new Laya.Vector3(0,0,0))}return t.createInstance=function(){this.Instance=new t},t.prototype.init=function(t){this._root=t,this.sceneCont=new Laya.Sprite,this._root.addChild(this.sceneCont),this._root.mouseEnabled=this.sceneCont.mouseEnabled=!0,Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.mouseDownHandler),Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.mouseMoveHandler),this.infoCont=new Laya.Sprite,this._root.addChild(this.infoCont),this.infoCont.mouseEnabled=!1,this.infoCont.mouseThrough=!0,n.ShaderManager.createInstance(),n.ShaderManager.Instance.initShaders(),a.CameraManager.createInstance(),o.AIManager.createInstance()},t.prototype.mouseDownHandler=function(t){if(a.CameraManager.Instance.mainCamera&&(this._mousePoint.elements[0]=Laya.MouseManager.instance.mouseX,this._mousePoint.elements[1]=Laya.MouseManager.instance.mouseY,a.CameraManager.Instance.mainCamera.viewportPointToRay(this._mousePoint,this._mouseRay),this.scene.physicsSimulation.rayCast(this._mouseRay,this._hitresult),this._hitresult.succeeded)){var e=this._hitresult.collider.owner;if(e.parent&&e.parent._aeId){var i=e.parent._aeId,n=s.EntityManager.Instance.getEntity(i);n&&r.BattleManager.Instance.useCard(n)}}},t.prototype.mouseMoveHandler=function(t){if(a.CameraManager.Instance.mainCamera){this._mousePoint.elements[0]=Laya.MouseManager.instance.mouseX,this._mousePoint.elements[1]=Laya.MouseManager.instance.mouseY,a.CameraManager.Instance.mainCamera.viewportPointToRay(this._mousePoint,this._mouseRay),this.scene.physicsSimulation.rayCast(this._mouseRay,this._hitresult);var e=this._lastMouseEntity,i=void 0;if(this._hitresult.succeeded){var n=this._hitresult.collider.owner;if(n.parent&&n.parent._aeId){var o=n.parent._aeId;i=s.EntityManager.Instance.getEntity(o),this._lastMouseEntity=i,i.model3D&&i.model3D.setSelected(!0)}}e&&e!=i&&e.model3D&&e.model3D.setSelected(!1)}},t.prototype.enter=function(){var t=l.ConfigManager.Instance.map["map_"+c.GameData.instance.mapid].url;Laya.loader.create(t,Laya.Handler.create(this,this.onLoadFinish))},t.prototype.destroyScene=function(){a.CameraManager.Instance.mainCamera&&a.CameraManager.Instance.mainCamera.parent&&a.CameraManager.Instance.mainCamera.parent.removeChild(a.CameraManager.Instance.mainCamera),this.directionLight&&(this.directionLight.destroy(!0),this.directionLight=null),this.scene.parent&&(this.scene.parent.removeChild(this.scene),this.scene.destroy(!0),this.scene=null);for(var t=l.ConfigManager.Instance.map["map_"+c.GameData.instance.mapid],e=0,i=t.allRes;e<i.length;e++){var n=i[e];h.ResDisposer.Instance.disposeRes(n)}h.ResDisposer.Instance.disposeRes(t.url)},t.prototype.onLoadFinish=function(){var t=Laya.loader.getRes(l.ConfigManager.Instance.map["map_"+c.GameData.instance.mapid].url);this.scene=this.sceneCont.addChild(t),this.initCamera(),this.initDirectionLight(),r.BattleManager.Instance.startGame()},t.prototype.updateTime=function(){},t.prototype.initDirectionLight=function(){this.directionLight=this.scene.addChild(new Laya.DirectionLight),this.directionLight.color=new Laya.Vector3(1.5,1.5,1.5),this.directionLight.transform.rotation=new Laya.Quaternion(.2205614,.5054134,.8231464,-.1354251),this.directionLight.shadow=!1},t.prototype.initCamera=function(){var t=a.CameraManager.Instance.mainCamera;t?this.scene.addChild(t):(t=this.scene.addChild(new Laya.Camera(0,.3,1e3)),a.CameraManager.Instance.mainCamera=t,t.fieldOfView=20,t.clearColor=new Laya.Vector4(.1921569,.3019608,.4745098,0),t.clearFlag=Laya.BaseCamera.CLEARFLAG_SKY,Laya.BaseMaterial.load("res/battle/skybox/skyBox.lmat",Laya.Handler.create(this,this.loadMaterial))),t.transform.position=new Laya.Vector3(-1.684368,5.801986,10.0834),t.transform.rotation=new Laya.Quaternion(-.2077771,-.09490746,-.02025976,.9733503)},t.prototype.loadMaterial=function(t){a.CameraManager.Instance.mainCamera.skyboxMaterial=t},t}();i.SceneManager=p},{"../../config/ConfigManager":46,"../../data/GameData":47,"../BattleManager":3,"./CameraManager":13,"./ShaderManager":16,"./entity/EntityManager":23,"./entity/ai/AIManager":28,"./util/ResDisposer":45}],16:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./shader/CustomShader"),a=function(){function t(){}return t.createInstance=function(){this.Instance=new t},t.prototype.initShaders=function(){n.CustomShader.initShader()},t}();i.ShaderManager=a},{"./shader/CustomShader":38}],17:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./util/GameUtils"),a=t("../../utils/Pool"),o=t("../../config/ConfigManager"),r=t("./skill/NormalHurtSkill"),s=t("./skill/MagicSkill"),l=function(){function t(){this.enabled=!0,this._skills={},this.empty=!0;this._skills={},this._readyToDispose=new Array,this.skillPools={},this.skillPools[1]=new a.Pool(r.NormalHurtSkill),this.skillPools[2]=new a.Pool(s.MagicSkill)}return Object.defineProperty(t,"Instance",{get:function(){return null!=this._instance&&void 0!=this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.updateTime=function(t){var e=!0;for(var i in this._skills){var n=this._skills[i];n.enabled&&n.update(t),e=!1}for(var a=0,o=this._readyToDispose;a<o.length;a++){var r=o[a];delete this._skills[r.id],r.dispose()}this._readyToDispose.length=0,this.empty=e},t.prototype.cleanSkill=function(){for(var t in this._skills){var e=this._skills[t];this._readyToDispose.push(e)}},t.prototype.readyToDie=function(t){this._readyToDispose.push(t)},t.prototype.createSkill=function(t){var e=o.ConfigManager.Instance.skill[t],i=this.skillPools[e.skilltype];if(i){var a=i.pop();return a.id=n.IDProvider.getSkillInsID(),a.enabled=!1,this._skills[a.id]=a,this.empty=!1,a}return null},t.prototype.returnSkill=function(t){var e=this.skillPools[t.type];e&&e.push(t)},t.prototype.getSkillById=function(t){return t in this._skills?this._skills[t]:null},t}();i.SkillManager=l},{"../../config/ConfigManager":46,"../../utils/Pool":60,"./skill/MagicSkill":39,"./skill/NormalHurtSkill":40,"./util/GameUtils":44}],18:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../../utils/Utils"),a=t("../../../data/GameTime"),o=t("../GameDefine"),r=t("../util/GameUtils"),s=t("../SceneManager"),l=t("../util/ResDisposer"),c=t("../../../config/ConfigManager"),h=function(){function t(){this._effectDic={},this._readyToDispose=[]}return t.createInstance=function(){this.Instance=new t,this.Instance.initPool()},t.prototype.initPool=function(){this._effectPools={},this._effectPools[p.NORMAL]=new n.Pool(f)},t.prototype.getEffect=function(t){return this._effectDic[t]},t.prototype.createEffect=function(t){var e=this._effectPools[t];if(e){var i=e.pop();return i.type=t,i.id=r.IDProvider.getEffectInsID(),i}return null},t.prototype.returnEffect=function(t){var e=this._effectPools[t.type];e&&e.push(t)},t.prototype.addEffect=function(t,e,i,n,o,r,l){void 0===r&&(r=null),void 0===l&&(l=0);var c=this.createEffect(p.NORMAL);c.init(t,s.SceneManager.Instance.scene,l+a.GameTime.Instance.totalGameTime,o),c.setPosition(e,i,n),r&&(c.rotation=r),this._effectDic[c.id]=c,0==o&&c.start()},t.prototype.destoryAllEffect=function(){for(var t in this._effectDic)this._effectDic[t].die();for(var e=0,i=this._readyToDispose;e<i.length;e++){var n=i[e];delete this._effectDic[n.id],n.dispose()}this._readyToDispose.length=0},t.prototype.updateTime=function(t){for(var e=0,i=this._readyToDispose;e<i.length;e++){var n=i[e];delete this._effectDic[n.id],n.dispose()}this._readyToDispose.length=0;for(var a in this._effectDic)this._effectDic[a].updateTime(t)},t.prototype.readyToDie=function(t){this._readyToDispose.push(t)},t}();i.EffectManager=h;var p;!function(t){t[t.NORMAL=0]="NORMAL",t[t.BULLET=1]="BULLET",t[t.ENTITY_EFFECT=2]="ENTITY_EFFECT",t[t.TREASURE=3]="TREASURE",t[t.BUFF=4]="BUFF"}(p=i.E_Effect_Type||(i.E_Effect_Type={}));var f=function(){function t(){this.enabled=!1,this._inView=!1}return t.prototype.init=function(t,e,i,n,a,o,s,l,c,h,p){void 0===i&&(i=-1),void 0===n&&(n=0),this.eid=t,this._container=e,this._loop=i,this._scale=0==l?null:l,this.offsetX=null==c?0:c,this.offsetY=null==h?0:h,this.startTime=n,this.id=r.IDProvider.getEffectInsID(),this._dir=a,this.soundid=o,this.attention=p},t.prototype.setTarget=function(t){this._targetEntity=t},Object.defineProperty(t.prototype,"rotation",{set:function(t){this._rotation||(this._rotation=new Laya.Quaternion(0,0,0,0)),t.cloneTo(this._rotation),this.animation&&r.GameUtils.setQuaternion(this.animation,this._rotation)},enumerable:!0,configurable:!0}),t.prototype.setPosition=function(t,e,i){if(this._x=t,this._y=e,this._z=i,this.animation){var n=this.animation.transform.localPosition;n.x=t,n.y=e,n.z=i,this.animation.transform.localPosition=n}},t.prototype.addToView=function(){null==this.animation&&this.initDisplay()},t.prototype.initDisplay=function(){this._skinConfig=c.ConfigManager.Instance.obj[t.Effect_Name+this.eid];var e=Laya.loader.getRes(this._skinConfig.url);e?this.loadedHandler(this.eid,this._skinConfig.url,e):(l.ResDisposer.Instance.addToLoading(this._skinConfig.url),Laya.Sprite3D.load(this._skinConfig.url,Laya.Handler.create(this,this.loadedHandler,[this.eid,this._skinConfig.url])))},t.prototype.initAnimation=function(){this.setPosition(this._x,this._y,this._z)},t.prototype.loadedHandler=function(t,e,i){t==this.eid?(l.ResDisposer.Instance.removeLoad(e),l.ResDisposer.Instance.addReferenceRes(e),this.animation=Laya.Sprite3D.instantiate(i.getChildAt(0)),this._container.addChild(this.animation),this.initAnimation()):l.ResDisposer.Instance.removeReferenceRes(e)},t.prototype.die=function(){this.enabled=!1,this.animation&&(this.animation.destroy(!0),this.animation=null),h.Instance.readyToDie(this)},t.prototype.start=function(){this.enabled||(this.enabled=!0,this.startTime=a.GameTime.Instance.totalGameTime,this.addToView()),this._targetEntity&&this._targetEntity.enabled&&(this.x=this._targetEntity.x+this.offsetX,this.y=this._targetEntity.y+this.offsetY)},Object.defineProperty(t.prototype,"inView",{get:function(){return this._inView},set:function(t){this._inView=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t},enumerable:!0,configurable:!0}),t.prototype.updateTime=function(t){this.enabled?this.animation?(this._targetEntity&&this._targetEntity.enabled&&(this.x=this._targetEntity.x+this.offsetX,this.y=this._targetEntity.y+this.offsetY),this._loop>0&&this.startTime+this._loop<t.totalGameTime&&this.die()):this._loop>0&&this.startTime+o.GameDefine.Effect_Wait_Time<t.totalGameTime&&this.die():this.startTime>0&&t.totalGameTime>this.startTime&&this.start()},t.prototype.dispose=function(){void 0!=this.id&&(this._skinConfig&&(l.ResDisposer.Instance.removeLoad(this._skinConfig.url)||l.ResDisposer.Instance.removeReferenceRes(this._skinConfig.url),this._skinConfig=null),this.id=void 0,this.enabled=!1,this._container=void 0,this.animation&&(this.animation.destroy(!0),this.animation=void 0),this._x=void 0,this._y=void 0,this._inView=!1,this.eid=void 0,this._loop=void 0,this._rotation=null,this._targetEntity=null,this.soundid=void 0,h.Instance.returnEffect(this))},t.Effect_Name="effect_",t}();i.NormalEffect=f},{"../../../config/ConfigManager":46,"../../../data/GameTime":48,"../../../utils/Utils":61,"../GameDefine":14,"../SceneManager":15,"../util/GameUtils":44,"../util/ResDisposer":45}],19:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./Entity"),a=t("./Model3D"),o=t("../SceneManager"),r=t("../../../data/GameTime"),s=t("../fsm/EntityFreeFsm"),l=t("../util/GameUtils"),c=t("./ai/AIManager"),h=t("./EntityManager"),p=t("./EntityInfo"),f=t("../SkillManager"),u=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n.a_truehp=0,n.a_delayhp=0,n.a_maxHp=0,n.a_isDead=!1,n.a_trueArmor=0,n.a_delayArmor=0,n._rotationTime=0,n.lastAngle=0,n.dir=0,n._moveAction=!1,n.poisonMarkValue=0,n.poisonMarkTimes=0,n.poisonMarkLastTime=0,n.deadTime=0,n}return __extends(e,t),e.prototype.createComponents=function(){this.deadTime=0,t.prototype.createComponents.call(this),this._entityInfo||(this._entityInfo=h.EntityManager.Instance.createEntityInfo(this),this._entityInfo.setTexts(p.EntityInfoType.NICKNAME,this.a_name,!0),null!=this.a_nameColor&&this._entityInfo.setTxtColor(p.EntityInfoType.NICKNAME,this.a_nameColor))},e.prototype.setBlood=function(t,e,i){void 0===i&&(i=!1),this._entityInfo&&this._entityInfo.setBlood(t,e,i&&!this.hideHp,!1,!0)},e.prototype.setNameColor=function(t){this.a_nameColor=t,this._entityInfo&&(this._entityInfo.setTxtColor(p.EntityInfoType.NICKNAME,t),this._entityInfo.setTxtColor(p.EntityInfoType.UNIONNAME,t))},e.prototype.showBloodEffect=function(t,e,i,n,a){void 0===a&&(a=1),this._entityInfo&&this._entityInfo.showBloodEffect(t,e,i,n,a),1==this.action&&this.setAction(6,null,!0)},e.prototype.initDisplay=function(){this.display=this.model3D=new a.Model3D,this.model3D.setPlayCompleteHandler(new Laya.Handler(this,this.playCompleteHandler)),this.model3D.init(this.id),o.SceneManager.Instance.scene.addChild(this.model3D),this.x=this._x,this.y=this._y,this.z=this._z,this.display.transform.position=this.display.transform.position,this._entityInfo&&this._entityInfo.updatePos(this.display.transform.position)},e.prototype.updateEquipments=function(t,e){if(this.a_weaponModel=t,this.a_clothModel=e,this.display){var i=e,n=t;this.changeSkins(i,n)&&this.setAction(this.action,this.dir,!0)}},e.prototype.updateWing=function(t){this.a_wingModel=t,null!=t&&t>0&&this.changeWing(t)&&this.setAction(this.action,this.dir,!0)},e.prototype.initWing=function(){var t=this.a_wingModel;null!=t&&t>0&&this.changeWing(t)},e.prototype.bianshen=function(t){},e.prototype.playCompleteHandler=function(){4!=this.action&&5!=this.action&&6!=this.action||this.setAction(1)},e.prototype.changeSkins=function(t,e){return this.model3D.createSkin(t+""),void 0!=e&&e>0&&this.model3D.updateWeapon(e+"",0),!1},e.prototype.changeWing=function(t){if(this.display)return!0},e.prototype.changeDir=function(t){this.dir!=t&&(this.dir=t)},e.prototype.setAction=function(t,e,i){if(void 0===e&&(e=-1),void 0===i&&(i=!1),this.action=t,-1!=e&&(this.dir=e),this.model3D)switch(t){case 3:case 2:this.model3D.playAni("run",i);break;case 4:this.model3D.playAni("attack",i);break;case 5:this.model3D.playAni("skill2",i);break;case 6:this.model3D.playAni("damage",i);break;case 10:this.model3D.playAni("die",i);break;default:this.model3D.playAni("idle",i)}},e.prototype.updateTime=function(e){t.prototype.updateTime.call(this,e),this.model3D&&this.model3D.update()},e.prototype.onEnterIdle=function(){this.setAction(1)},e.prototype.onMoveComplete=function(t,e){if(t.isBusy)t.setAction(1);else if(t._entityAI)t._entityAI.moveComplete(t,e);else{if(t.pathArr&&t.pathArr.length>0){var i=t.pathArr.pop();return t.prepareToMove(i[0],i[1]),t.onEnterMove(),void(0==t.pathArr.length&&(t.pathArr=null))}t.changeFSMState(s.EntityFreeFsm.Instance)}},e.prototype.onExecuteMove=function(e){if(t.prototype.onExecuteMove.call(this,e),this._directionVec){var i=new Laya.Quaternion;Laya.Quaternion.rotationLookAt(this._directionVec,l.GameUtils.Vector3UpTemp,i);var n=new Laya.Quaternion;this._rotationTime+=e.elapsedGameTime,this._rotationTime>500&&(this._rotationTime=500),Laya.Quaternion.lerp(this.model3D.transform.rotation,i,this._rotationTime/500,n),this.model3D.transform.rotation=n}this._tween&&this._tween.enabled||this.isBusy||c.AIManager.Instance.isAIIntervalLimit(this.uid)||!(void 0==this.waitForNextMove||this.waitForNextMove<e.totalGameTime)||this.changeFSMState(s.EntityFreeFsm.Instance)},e.prototype.onEnterFree=function(){this.setAction(1),this.freeTime=r.GameTime.Instance.totalGameTime+this.idleInterval},e.prototype.onEnterMove=function(){t.prototype.onEnterMove.call(this),this._rotationTime=0;var e=l.DirectionUtil.orientation(this.x,-this.z,this.movePostion.x,-this.movePostion.y),i=e-this.lastAngle;i>180?e=this.lastAngle+i-360:i<-180&&(e=this.lastAngle+i+360),this._directionVec=l.GameUtils.ConvertDirToVector3(e),this.lastAngle=e;var n=l.DirectionUtil.getForwardByPoints(this.x,this.z,this.movePostion.x,this.movePostion.y);this._moveAction?this.setAction(2,n):this.setAction(3,n),this._entityAI&&this._entityAI.moveToServer(this,this.movePostion.cellX,this.movePostion.cellY)},e.prototype.onEnterForceMove=function(){t.prototype.onEnterForceMove.call(this);var e=l.DirectionUtil.getForwardByPoints(this.x,this.y,this.movePostion.x,this.movePostion.y);e=l.DirectionUtil.addDir(e,4),this.setAction(1,e)},e.prototype.prepareSkillData=function(t){this._prepareSkill=t},e.prototype.onReleaseSkill=function(){this._prepareSkill?(this._prepareSkill.play(),this._prepareSkill=null):this.setAction(1)},e.prototype.onPickup=function(){this.setAction(1)},e.prototype.dieEnd=function(t){void 0===t&&(t=!1),this.deadTime=0,t&&(this.display&&(this.display.parent&&this.display.parent.removeChild(this.display),this.display.destroy(!0),this.display=null,this.model3D=null),this._entityInfo&&(this._entityInfo.dispose(),this._entityInfo=null),this.enabled=!1),this._inView=!1},e.prototype.die=function(){this.setAction(10),this._entityInfo&&(this._entityInfo.dispose(),this._entityInfo=null)},e.prototype.relive=function(t){void 0===t&&(t=!1),this.enabled=!0,this.a_isDead=!1,this.createComponents(),this.checkInfoInview()},e.prototype.removeFromView=function(){t.prototype.removeFromView.call(this),this.model3D=null},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.display=void 0,this._prepareSkill&&(f.SkillManager.Instance.readyToDie(this._prepareSkill),this._prepareSkill=null)},e}(n.Entity);i.AnimalEntity=u},{"../../../data/GameTime":48,"../SceneManager":15,"../SkillManager":17,"../fsm/EntityFreeFsm":33,"../util/GameUtils":44,"./Entity":21,"./EntityInfo":22,"./EntityManager":23,"./Model3D":24,"./ai/AIManager":28}],20:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./EntityManager"),a=t("../util/BitmapPool"),o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.images=[],e._plus=0,e}return __extends(e,t),e.create=function(){return this.movies.length>0?this.movies.pop():this.UseCount>30?null:(this.UseCount++,new e)},e.prototype.returnToPool=function(){this.parent&&this.parent.removeChild(this),this.alpha=1,this._plus=0,e.movies.indexOf(this)>=0||e.movies.push(this)},e.prototype.show=function(t,e,i){var o=0;if(this._plus=e,e>0){var r=t+"_c",s=!1;switch(e){case 4:r="sl",s=!0;break;case 5:r="st",s=!0;break;case 7:r="mb",s=!0;break;case 6:n.EntityManager.Instance.firstPlayer;r="fh",s=!0;break;case 2:r="ws";break;case 1:r=t+"_c";break;case 3:r=t+"_name";break;case 8:r="poison";break;case 9:r="recovery";break;case 10:r="suck";break;case 11:r="reound"}if(this._img_type?this._img_type.texture=Laya.loader.getRes("bloodfont/"+r+".png"):this._img_type=a.default.createBp(Laya.loader.getRes("bloodfont/"+r+".png")),this._img_type.y=-15,this._img_type.x=0,9==e||10==e?this._img_type.y=-5:11==e?this._img_type.y=2:3==e&&(this._img_type.y=-60,this._img_type.x=55,20411==t&&(this._img_type.x=40)),null==this._img_type.parent&&this.addChildAt(this._img_type,0),s){for(;this.images.length>0;){var l=this.images.pop();a.default.pushBp(l),l.parent&&l.parent.removeChild(l)}return}o=this._img_type.width}else this._img_type&&(a.default.pushBp(this._img_type),this._img_type.parent&&this._img_type.parent.removeChild(this._img_type),this._img_type=null);this.images=this.addNumber(t,5==t?"+"+i:i+"",o,0,e)},e.prototype.addNumber=function(t,e,i,n,o){for(var r=e.length,s=i,l=this.images;l.length>r;){p=this.images.pop();a.default.pushBp(p),p.removeSelf()}if("0"==e){for(;l.length>0;){p=this.images.pop();a.default.pushBp(p),p.removeSelf()}return l}for(var c=0;c<r;c++){var h=e.charAt(c),p=void 0;l.length>c&&null!=l[c]?(null==(p=l[c]).parent&&this.addChild(p),p.texture=Laya.loader.getRes("bloodfont/"+t+"_"+h+".png")):(p=a.default.createBp(Laya.loader.getRes("bloodfont/"+t+"_"+h+".png")),this.addChild(p),l.push(p)),p.x=s,s+=p.width-3}return this._w=s,l},Object.defineProperty(e.prototype,"width",{get:function(){return this._w},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){if(this.images){for(var t=0,e=this.images;t<e.length;t++){var i=e[t];i.parent&&(i.parent.removeChild(i),a.default.pushBp(i),i.texture=null)}this.images=null}this._img_type&&(this._img_type.parent.removeChild(this._img_type),a.default.pushBp(this._img_type),this._img_type.texture=null),this.parent&&this.parent.removeChild(this)},e.movies=[],e.UseCount=0,e}(Laya.Sprite);i.BloodMovie=o},{"../util/BitmapPool":43,"./EntityManager":23}],21:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./ai/AIManager"),a=t("../fsm/EntityFreeFsm"),o=t("../../../data/GameTime"),r=t("../GameDefine"),s=t("../transform/Tween"),l=t("../util/GameUtils"),c=function(){function t(t,e){this.enabled=!0,this._busy=0,this.idleInterval=0,this.freeTime=0,this.a_state=0,this.movePostion=new h,this._coverd=!1,this._inView=!1,this._hideDisplay=!1,this._hideInfo=!1,this.uid=t.toString(),this.id=t,this.type=e}return Object.defineProperty(t.prototype,"_entityAI",{get:function(){return this.entityAI},set:function(t){this.entityAI=t},enumerable:!0,configurable:!0}),t.prototype.createComponents=function(){this._tween||(this._tween=new s.Tween(this),this._tween.moveComplete=this.onMoveComplete)},t.prototype.checkHide=function(){},t.prototype.setSkin=function(t){},t.prototype.stopTween=function(){this._tween&&this._tween.stop()},t.prototype.initDisplay=function(){},t.prototype.displayCreated=function(){this._coverd&&this.display},Object.defineProperty(t.prototype,"inView",{get:function(){return this._inView},set:function(t){this._inView=t},enumerable:!0,configurable:!0}),t.prototype.hideDisplay=function(t){this._hideDisplay!=t&&(this._hideDisplay=t,this.checkDisplayInview())},t.prototype.getHideDisplay=function(){return this._hideDisplay},t.prototype.hideInfo=function(t){this._hideInfo!=t&&(this._hideInfo=t,this.checkInfoInview())},t.prototype.checkDisplayInview=function(){this._inView&&!this._hideDisplay?null==this.display&&this.addToView():null!=this.display&&this.removeFromView()},t.prototype.checkInfoInview=function(){this._inView&&!this._hideInfo?this._entityInfo&&(this._entityInfo.inView=!0):this._entityInfo&&(this._entityInfo.inView=!1)},Object.defineProperty(t.prototype,"tween",{get:function(){return this._tween},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"moveNext",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"endNow",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.setPosition=function(t,e){this.gridX=t,this.gridY=e},t.prototype.setPixelPosition=function(t,e,i){this.x=t,this.y=e,this.z=i,this.display.transform.position=this.display.transform.position},t.prototype.setHorizontalPosition=function(t,e){var i=this.display.transform.position;i.x=t,i.z=e;var n=0;isNaN(n)&&(n=0),i.y=n,this.display.transform.position=i,this._entityInfo&&this._entityInfo.updatePos(i)},t.prototype.updateInfoPos=function(){this._entityInfo&&this.display&&this._entityInfo.updatePos(this.display.transform.position)},Object.defineProperty(t.prototype,"x",{get:function(){return this.display?this.display.transform.position.x:this._x},set:function(t){if(this.display?this.display.transform.position.x=t:this._x=t,this._entityInfo){var e=l.GameUtils.Vector3Temp2;e.x=t,e.y=this._y,e.z=this._z,this._entityInfo.updatePos(e)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.display?this.display.transform.position.y:this._y},set:function(t){this.display?this.display.transform.position.y=t:this._y=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this.display?this.display.transform.position.z:this._z},set:function(t){if(this._z=t,this.display&&(this.display.transform.position.z=t),this._entityInfo){var e=l.GameUtils.Vector3Temp2;e.z=t,e.x=this._x,e.y=this._y,this._entityInfo.updatePos(e)}},enumerable:!0,configurable:!0}),t.prototype.updateTime=function(t){this._entityInfo&&this._entityInfo.sortShow(),this.curFsm&&this.curFsm.execute(this,t)},t.prototype.updateRect=function(t){var e=t.contains(this.x,this.y);e!=this._inView&&(this.inView=e,this.checkDisplayInview(),this.checkInfoInview())},t.prototype.resetPosition=function(){},t.prototype.hitTest=function(t,e){if(!this._inView)return!1;if(.5*-r.GameDefine.MAP_GRID_WIDTH<t&&.5*-r.GameDefine.MAP_GRID_HEIGHT<e&&.5*r.GameDefine.MAP_GRID_WIDTH>t&&.5*r.GameDefine.MAP_GRID_HEIGHT>e)return!0;if(null==this.display)return!1;return!1},t.prototype.removeFromView=function(){this.display.parent&&this.display.parent.removeChild(this.display),this.display.destroy(!0),this.display=null},t.prototype.addToView=function(){this._inView=!0,this.initDisplay()},t.prototype.changeFSMState=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!0),null!=this.curFsm&&this.curFsm.stateChange(this,t)||(i||this.curFsm!=t)&&(null!=this.curFsm&&this.curFsm.exit(this),this.curFsm=t,this.curFsm.enter(this,e))},Object.defineProperty(t.prototype,"isBusy",{get:function(){return this._busy>o.GameTime.Instance.totalGameTime},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"busy",{set:function(t){this._busy=Math.max(o.GameTime.Instance.totalGameTime+t,this._busy)},enumerable:!0,configurable:!0}),t.prototype.onEnterIdle=function(){},t.prototype.onEnterFree=function(){this.freeTime=o.GameTime.Instance.totalGameTime+this.idleInterval},t.prototype.onEnterMove=function(){this._tween&&(this._tween.move([this.movePostion.x,this.movePostion.y]),this._tween.setSpeed(this.movePostion.speed))},t.prototype.onEnterForceMove=function(){this._tween&&(this._tween.move([this.movePostion.x,this.movePostion.y]),this._tween.setSpeed(this.movePostion.speed))},t.prototype.prepareToMove=function(t,e,i,n){void 0===i&&(i=.5),this.movePostion.x=t,this.movePostion.y=e,this.movePostion.cellX=t,this.movePostion.cellY=e,this.movePostion.speed=i,n||this.setPosition(t,e)},t.prototype.onExecuteMove=function(t){this._tween&&this._tween.enabled&&this._tween.updateTime(t)},t.prototype.onMoveComplete=function(t,e){t.changeFSMState(a.EntityFreeFsm.Instance)},t.prototype.dispose=function(){this.display&&(this.display.parent&&this.display.parent.removeChild(this.display),this.display.destroy(!0),this.display=null),this._entityInfo&&(this._entityInfo.dispose(),this._entityInfo=null),this._entityAI&&(n.AIManager.Instance.removeEntityAI(this.uid),this._entityAI=null),this.uid=null,this.id=null,this.enabled=!1},t}();i.Entity=c;var h=function(){return function(){}}();i.EntityMoveInfo=h},{"../../../data/GameTime":48,"../GameDefine":14,"../fsm/EntityFreeFsm":33,"../transform/Tween":42,"../util/GameUtils":44,"./ai/AIManager":28}],22:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n,a=t("../SceneManager"),o=t("../CameraManager"),r=t("../util/GameUtils"),s=t("./BloodMovie");!function(t){t[t.ALL=0]="ALL",t[t.BLOODBAR=1]="BLOODBAR",t[t.BLOODVALUE=2]="BLOODVALUE",t[t.INNERBAR=3]="INNERBAR",t[t.NICKNAME=4]="NICKNAME",t[t.UNIONNAME=5]="UNIONNAME",t[t.NONSENSE=6]="NONSENSE",t[t.JUNXIANNAME=7]="JUNXIANNAME",t[t.TIME=8]="TIME",t[t.TITLE=9]="TITLE"}(n=i.EntityInfoType||(i.EntityInfoType={}));var l=function(){function t(e){this._texts={},this._needSort=!1,this._posArr=[],this._bloodY=0,this._nameY=137,this.iconY=0,this._inView=!1,this._ae=e,this._cont=t.createSp(),a.SceneManager.Instance.infoCont.addChild(this._cont)}return t.createSp=function(){var t=this.spPool.length>0?this.spPool.pop():new Laya.Sprite;return t.visible=!0,t},t.pushSp=function(t){this.spPool.length<80&&this.spPool.push(t)},Object.defineProperty(t.prototype,"inView",{get:function(){return this._inView},set:function(t){this._inView!=t&&(!t&&this._cont.parent?this._cont.parent.removeChild(this._cont):t&&!this._cont.parent&&a.SceneManager.Instance.infoCont.addChildAt(this._cont,0),this._inView=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{set:function(t){this._cont&&(this._cont.visible=t)},enumerable:!0,configurable:!0}),t.prototype.setNameY=function(t){this._nameY=t,this._needSort=!0},t.prototype.setBloodY=function(t){this._bloodY=t,this._needSort=!0},t.prototype.setBlood=function(t,e,i,a,o){void 0===i&&(i=!1),void 0===a&&(a=!1),void 0===o&&(o=!1);null==this._bloodBar&&(this._bloodBar=new Laya.Image("common/red_blood.png"),this._bloodBarBg=new Laya.Image("common/empty_blood.png"),this._bloodBar&&(this._bloodBarBg.x=-this._bloodBarBg.width>>1,this._bloodBar.x=-this._bloodBar.width>>1,this._bloodBar.y=this._bloodBarBg.y=-this._bloodY),this.setPosition(n.BLOODBAR),this.setPosition(n.BLOODVALUE));this._bloodBar.scaleX;this._bloodBar.scaleX=Math.min(t/e,1),(o||this.getText(n.BLOODVALUE))&&this.setTexts(n.BLOODVALUE,t+"/"+e),i&&(this._cont.addChildAt(this._bloodBarBg,0),this._cont.addChild(this._bloodBar),this.showText(n.BLOODVALUE))},t.prototype.showText=function(t){this._texts[t]&&0==this._cont.contains(this._texts[t])&&(this._cont.addChild(this._texts[t]),this._needSort=!0)},t.prototype.hideText=function(t){this._texts[t]&&this._cont.contains(this._texts[t])&&(this._cont.removeChild(this._texts[t]),this._needSort=!0)},t.prototype.hideBlood=function(){this._cont.contains(this._bloodBarBg)&&this._cont.removeChild(this._bloodBarBg),this._cont.contains(this._bloodBar)&&this._cont.removeChild(this._bloodBar),this.hideText(n.BLOODVALUE),this._needSort=!0},t.prototype.setTexts=function(t,e,i){void 0===i&&(i=!1);var n=this.getText(t);null==n&&(n=this.addText(t)),this.setText(t,e,n),i&&(this.showText(t),this.setPosition(t))},t.prototype.getText=function(t){return this._texts[t]},t.prototype.setPosition=function(t){void 0===t&&(t=0),this.locateX(t),this.locateY(t)},t.prototype.addText=function(t,e){void 0===e&&(e="#FFFFFF");var i=new Laya.Label;return i.fontSize=20,i.bold=!0,this._colorSet&&null!=this._colorSet[t]&&(e=this._colorSet[t]),i.color=e,i.width=180,i.align="center",this._texts[t]=i,this._needSort=!0,i},t.prototype.setText=function(t,e,i){void 0===i&&(i=null),null==i&&(i=this.getText(t)),i.text=null==e?"":e,t!=n.NICKNAME&&t!=n.UNIONNAME&&t!=n.JUNXIANNAME&&t!=n.BLOODVALUE||(i.width=140,i.x=-70)},t.prototype.locateX=function(t){void 0===t&&(t=0);var e;if(t==n.ALL)for(var i in this._texts)switch(e=this._texts[i],Number(i)){case n.NICKNAME:case n.UNIONNAME:case n.BLOODVALUE:case n.TIME:case n.JUNXIANNAME:e.x=Math.round(.5*-e.width)}else if(e=this._texts[t])switch(t){case n.NICKNAME:case n.UNIONNAME:case n.BLOODVALUE:case n.TIME:case n.JUNXIANNAME:e.x=Math.round(.5*-e.width)}},t.prototype.locateY=function(t){void 0===t&&(t=0);var e;if(t==n.ALL)for(var i in this._texts)switch(e=this._texts[i],Number(i)){case n.NICKNAME:e.y=0-this._posArr[1];break;case n.UNIONNAME:e.y=0-this._posArr[3];break;case n.JUNXIANNAME:e.y=0-this._posArr[2];break;case n.BLOODVALUE:e.y=0-this._posArr[0];break;case n.TIME:e.y=0}else if(e=this._texts[t])switch(t){case n.NICKNAME:e.y=0-this._posArr[1];break;case n.UNIONNAME:e.y=0-this._posArr[3];break;case n.JUNXIANNAME:e.y=0-this._posArr[2];break;case n.TIME:e.y=0;case n.BLOODVALUE:e.y=0-this._posArr[0]}},t.prototype.sortShow=function(){if(this._needSort){var e=0,i=0,n=t.SORTRULE,a=0;for(var o in n){var r=n[o],s=this.getText(r);s&&s.visible&&s.parent?(this._posArr[e]=a=28*i+this._bloodY+30,i++):this._posArr[e]=0,e++}this.iconY=a,this.locateY(),this._needSort=!1}},t.prototype.updatePos=function(t){var e=r.GameUtils.Vector3Temp,i=r.GameUtils.Vector3Temp3,n=o.CameraManager.Instance.mainCamera;i.x=t.x,i.y=t.y+2,i.z=t.z,n.viewport.project(i,n.projectionViewMatrix,e),this.setPositionX(e.x/Laya.stage.clientScaleX),this.setPositionY(e.y/Laya.stage.clientScaleY)},t.prototype.setPositionX=function(t){this._cont.x=t},t.prototype.setPositionY=function(t){this._cont.y=t},t.prototype.dispose=function(){if(this._colorSet=null,this._cont){for(var e=this._cont;e.numChildren>0;)e.removeChildAt(0);e.parent&&e.parent.removeChild(e),t.pushSp(e),this._cont=null}this._bloodBar&&(this._bloodBar.texture=null,this._bloodBar=null),this._bloodBarBg&&(this._bloodBarBg.texture=null,this._bloodBarBg=null),this._ae=null,this._posArr=null,this._texts&&(this._texts=null)},t.prototype.showBloodEffect=function(t,e,i,n,o){if(this._inView){var r=s.BloodMovie.create();if(null!=r){r.show(i,n,t),r.x=this._cont.x-r.width/2,r.y=this._cont.y-80-20,n>0&&(r.x+=30,r.y+=30);var l=a.SceneManager.Instance.infoCont;if(l.numChildren>0)l.getChildAt(l.numChildren-1);l.addChild(r),Laya.Tween.clearTween(r);var c,h,p,f;0==e?p=c=r.x:1==e?p=(c=r.x-40-Math.round(40*Math.random()))-30:2==e&&(p=(c=r.x+40+Math.round(40*Math.random()))+30),f=(h=r.y-20-Math.round(30*Math.random()))-50,Laya.Tween.to(r,{x:c,y:h,scaleX:1.5,scaleY:1.5},100,Laya.Ease.sineIn).to(r,{scaleX:1,scaleY:1},100,Laya.Ease.sineIn).to(r,{},300,Laya.Ease.sineIn).to(r,{x:p,y:f,alpha:0},600,Laya.Ease.sineIn,Laya.Handler.create(this,function(){r.returnToPool()}))}}},t.prototype.setTxtColor=function(t,e){var i=this.getText(t);this._colorSet||(this._colorSet={}),this._colorSet[t]=e,null!=i&&(i.color=e)},t.spPool=[],t.SORTRULE=[n.BLOODVALUE,n.NICKNAME,n.JUNXIANNAME,n.UNIONNAME],t}();i.EntityInfo=l},{"../CameraManager":13,"../SceneManager":15,"../util/GameUtils":44,"./BloodMovie":20}],23:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./Player"),a=t("../util/GameUtils"),o=t("./EntityInfo"),r=t("./Monster"),s=function(){function t(){this._entityDic={},this._enemyDic={},this._readyToDispose=[],this._playerDic={},this._resized=!1}return Object.defineProperty(t,"Instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.getEntity=function(t){return this._entityDic[t]},t.prototype.getAllEntity=function(){return this._entityDic},t.prototype.getAllEnemy=function(){return this._enemyDic},t.prototype.createPlayer=function(){var t=this.createEntity(6,a.IDProvider.getEntityInsID());return this._playerDic[t.uid]=t,t},t.prototype.createEnemy=function(t){return this.createEntity(4,t)},t.prototype.createComponent=function(t){t.createComponents()},t.prototype.createEntity=function(t,e){var i;switch(t){case 6:i=new n.Player(e,t),this._playerDic[e.toString()]=i;break;case 4:i=new r.Monster(e,t),this._enemyDic[e.toString()]=i}return i&&(this._entityDic[e.toString()]=i),i},t.prototype.createEntityInfo=function(t){return t.type,new o.EntityInfo(t)},t.prototype.resize=function(){this._resized=!0},t.prototype.update=function(t){this.updateDead(t);var e;for(var i in this._entityDic)(e=this._entityDic[i]).updateTime(t),this._resized&&e.updateInfoPos();this._resized=!1},t.prototype.updateDead=function(t){for(var e=0,i=this._readyToDispose;e<i.length;e++){var n=i[e];n&&this.destoryEntity(n.uid)}this._readyToDispose.length=0},t.prototype.destoryAllEntity=function(){for(var t in this._entityDic)this.destoryEntity(t)},t.prototype.destoryEntity=function(t){var e=this._entityDic[t];if(e){switch(e.type){case 6:this.firstPlayer&&this.firstPlayer.uid==t&&(this.firstPlayer=null),delete this._playerDic[t];break;case 4:delete this._playerDic[t],delete this._enemyDic[t]}return e.dispose(),delete this._entityDic[t],!0}return!1},t}();i.EntityManager=s},{"../util/GameUtils":44,"./EntityInfo":22,"./Monster":25,"./Player":26}],24:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../SceneManager"),a=t("../util/ResDisposer"),o=t("../../../config/ConfigManager"),r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._weaponModels=[],e._weaponConfigs=[],e._weaponMeshs=[],e._selected=!1,e._disposed=!1,e}return __extends(e,t),e.prototype.init=function(t){this._aeId=t},e.prototype.createSkin=function(t){if(!this.meshSprite3D){this._skinConfig=o.ConfigManager.Instance.obj["model_"+t],this._skinModel=t;Laya.loader.getRes(this._skinConfig.url)?this.createMesh(t,this._skinConfig.url):(a.ResDisposer.Instance.addToLoading(this._skinConfig.url),Laya.Sprite3D.load(this._skinConfig.url,Laya.Handler.create(this,this.createMesh,[t,this._skinConfig.url])))}},e.prototype.setSelected=function(t,e){void 0===e&&(e=!1),(this._selected!=t||e)&&(this._selected=t,this.meshSprite3D&&(t?this.setMeshMatValue(this.meshSprite3D,"marginalColor",new Laya.Vector3(0,.3,1)):this.setMeshMatValue(this.meshSprite3D,"marginalColor",null)))},e.prototype.readMesh=function(t){for(var e=0,i=t._children;e<i.length;e++){var n=i[e];if(n.skinnedMeshRenderer){var a=n.skinnedMeshRenderer.sharedMaterial;a&&(n.skinnedMeshRenderer.sharedMaterial=a.clone())}else if(n._children)for(var o=0,r=n._children;o<r.length;o++){var s=r[o];this.readMesh(s)}}},e.prototype.destroyMesh=function(t){for(var e=0,i=t._children;e<i.length;e++){var n=i[e];if(n.skinnedMeshRenderer){var a=n.skinnedMeshRenderer.sharedMaterial;a&&a.destroy()}else if(n._children)for(var o=0,r=n._children;o<r.length;o++){var s=r[o];this.destroyMesh(s)}}},e.prototype.setMeshMatValue=function(t,e,i){for(var n=0,a=t._children;n<a.length;n++){var o=a[n];if(o.skinnedMeshRenderer){var r=o.skinnedMeshRenderer.sharedMaterial;r&&(r[e]=i?new Laya.Vector3(0,.3,1):null)}else if(o._children)for(var s=0,l=o._children;s<l.length;s++){var c=l[s];this.setMeshMatValue(c,e,i)}}},e.prototype.createMesh=function(t,e){if(this._skinModel==t){var i=Laya.loader.getRes(e);a.ResDisposer.Instance.removeLoad(e),a.ResDisposer.Instance.addReferenceRes(e),this.meshSprite3D=Laya.Sprite3D.instantiate(i.getChildAt(0)),this.meshSprite3D.transform.position=new Laya.Vector3(0,0,0),this.addChild(this.meshSprite3D),this.readMesh(this.meshSprite3D),this._selected&&this.setSelected(this._selected,!0),this.animator=this.meshSprite3D.getComponent(Laya.Animator),this.animator.play("idle"),this._weaponSprite&&this._weaponSprite.loaded&&this.animator.linkSprite3DToAvatarNode(this._skinConfig.hand,this._weaponSprite)}else a.ResDisposer.Instance.removeReferenceRes(e)},e.prototype.weaponloaded=function(){this._weaponSprite=Laya.Sprite3D.instantiate(this._weaponSprite.getChildAt(0)),n.SceneManager.Instance.scene.addChild(this._weaponSprite),this.animator&&this.animator.linkSprite3DToAvatarNode(this._skinConfig.hand,this._weaponSprite)},e.prototype.updateSkin=function(t){this._skinModel!=t&&(this.removeSkin(),this._skinModel=t,t&&this.createSkin(t))},e.prototype.removeSkin=function(){this.meshSprite3D&&(this.destroyMesh(this.meshSprite3D),this.meshSprite3D.destroy(!0),this.meshSprite3D=null,a.ResDisposer.Instance.removeLoad(this._skinConfig.url)||a.ResDisposer.Instance.removeReferenceRes(this._skinConfig.url))},e.prototype.updateWeapon=function(t,e){},e.prototype.createWeaponMesh=function(t){},e.prototype.removeWeapon=function(t){},e.prototype.playAni=function(t,e){if(void 0===e&&(e=!1),e||this._curAction!=t){if(this._curAction=t,!this.animator)return;switch(t){case"idle":case"run":this.animator.play("idle");break;case"die":this.animator.play("die",0,0);break;case"dieEnd":this.animator.play("die");break;case"attack":this.animator.play("attack",0,0);break;case"skill":this.animator.play("skill",0,0);break;case"damage":this.animator.play("damage",0,0)}}},e.prototype.update=function(){this.animator&&this.animator.getCurrentAnimatorPlayState(0)._finish&&this._playCompleteHandler&&this._playCompleteHandler.run()},e.prototype.onSkinAniChange=function(){"die"==this._curAction||this.stop()},e.prototype.setPlayCompleteHandler=function(t){this._playCompleteHandler=t},e.prototype.stop=function(){},e.prototype.destroy=function(e){void 0===e&&(e=!0),this._disposed||(this.removeSkin(),this.animator=null,this._playCompleteHandler=null,this._disposed=!0,this._skinConfig=null,this._skinModel=null,t.prototype.destroy.call(this,e))},e}(Laya.Sprite3D);i.Model3D=r},{"../../../config/ConfigManager":46,"../SceneManager":15,"../util/ResDisposer":45}],25:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype.createComponents=function(){t.prototype.createComponents.call(this)},e.prototype.checkHide=function(){},e.prototype.initDisplay=function(){t.prototype.initDisplay.call(this),this.initEquipments(),this.setBlood(this.a_truehp,this.a_maxHp,!0)},e.prototype.initEquipments=function(){var t,e,i=this.a_clothModel,n=this.a_weaponModel;t=null!=i&&i>0?i:2==this.a_sex?9002:9001,null!=n&&n>0&&(e=n),this.changeSkins(t,e)},e.prototype.updateEquipments=function(t,e){if(this.a_weaponModel=t,this.a_clothModel=e,this.display){var i=void 0,n=void 0;i=null!=e&&e>0?e:2==this.a_sex?9002:9001,null!=t&&t>0&&(n=t),this.changeSkins(i,n)&&this.setAction(this.action,this.dir,!0)}},e.prototype.dispose=function(){t.prototype.dispose.call(this)},e}(t("./AnimalEntity").AnimalEntity);i.Monster=n},{"./AnimalEntity":19}],26:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function e(e,i){return t.call(this,e,i)||this}return __extends(e,t),e.prototype.createComponents=function(){t.prototype.createComponents.call(this)},e.prototype.checkHide=function(){},e.prototype.setPosition=function(e,i){t.prototype.setPosition.call(this,e,i)},e.prototype.initDisplay=function(){t.prototype.initDisplay.call(this),this.initEquipments(),this.initWing(),this.setBlood(this.a_truehp,this.a_maxHp,!0)},e.prototype.setAction=function(t,e,i){if(void 0===e&&(e=-1),void 0===i&&(i=!1),this.action=t,-1!=e&&(this.dir=e),this.model3D)switch(t){case 3:case 2:this.model3D.playAni("run",i);break;case 4:this.model3D.playAni("attack",i);break;case 5:this.model3D.playAni("skill2",i);break;default:this.model3D.playAni("idle",i)}},e.prototype.initWing=function(){var t=this.a_wingModel},e.prototype.initEquipments=function(){var t,e,i=this.a_clothModel,n=this.a_weaponModel;t=null!=i&&i>0?i:2==this.a_sex?9002:9001,null!=n&&n>0&&(e=n),this.changeSkins(t,e)},e.prototype.updateEquipments=function(t,e){if(this.a_weaponModel=t,this.a_clothModel=e,this.display){var i=void 0,n=void 0;i=null!=e&&e>0?e:2==this.a_sex?9002:9001,null!=t&&t>0&&(n=t),this.changeSkins(i,n)&&this.setAction(this.action,this.dir,!0)}},e.prototype.updateWing=function(t){if(this.a_wingModel=t,null!=t&&t>0){var e=t;this.changeWing(e)&&this.setAction(this.action,this.dir,!0)}},e.prototype.updateTitle=function(t){this.a_titleId=t},e.prototype.updateUnionName=function(t){this.a_unionName=t},e.prototype.updatePlayerName=function(t){this.a_name=t},e.prototype.dispose=function(){t.prototype.dispose.call(this)},e}(t("./AnimalEntity").AnimalEntity);i.Player=n},{"./AnimalEntity":19}],27:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../fsm/EntityFreeFsm"),a=t("./AIManager"),o=t("../../fsm/EntityMoveFsm"),r=function(){function t(){this.state=1,this.skillDelayTime=1e3}return t.prototype.moveComplete=function(t,e){if(1==t.curFsm.getState()){if(0!=this.check(t))return}t.changeFSMState(n.EntityFreeFsm.Instance)},t.prototype.check=function(t){if(0==this.state)return 0;if(a.AIManager.Instance.isAIIntervalLimit(t.uid))return 0;if(t.pathArr&&t.pathArr.length>0){var e=t.pathArr.shift();t.prepareToMove(e[0],e[1],.1),1==t.curFsm.getState()?t.onEnterMove():t.changeFSMState(o.EntityMoveFsm.Instance)}return 3},t.prototype.doSkill=function(t,e,i,n){return void 0===n&&(n=1),!1},t.prototype.doSomething=function(t,e){},t.prototype.start=function(){this.state=1},t.prototype.stop=function(){this.state=0},t.prototype.die=function(t){},t.prototype.relive=function(t){},t.prototype.dieEnd=function(t){},t.prototype.moveToServer=function(t,e,i){},t.prototype.skillToServer=function(t,e,i){},t.prototype.pickupServer=function(t,e,i){},t}();i.AIBase=r},{"../../fsm/EntityFreeFsm":33,"../../fsm/EntityMoveFsm":34,"./AIManager":28}],28:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../fsm/EntityDeadFsm"),a=t("../../fsm/EntitySkillFsm"),o=t("../../fsm/EntityForceMoveFsm"),r=t("../../fsm/EntityFreeFsm"),s=t("../../fsm/EntityMoveFsm"),l=t("../../fsm/EntityPickupFsm"),c=t("../../../../data/GameTime"),h=t("./PlayerAI"),p=t("./MonsterAI"),f=function(){function t(){this.aiDic={},this.aiIntevalDic={},this.aiDic[0]=h.PlayerAI,this.aiDic[1]=p.MonsterAI}return t.createInstance=function(){this.Instance=new t,n.EntityDeadFsm.Instance=new n.EntityDeadFsm,a.EntitySkillFsm.Instance=new a.EntitySkillFsm,o.EntityForceMoveFsm.Instance=new o.EntityForceMoveFsm,r.EntityFreeFsm.Instance=new r.EntityFreeFsm,s.EntityMoveFsm.Instance=new s.EntityMoveFsm,l.EntityPickupFsm.Instance=new l.EntityPickupFsm},t.prototype.isAIIntervalLimit=function(t){var e=this.aiIntevalDic[t];return void 0==e&&(e=0),e>c.GameTime.Instance.totalGameTime},t.prototype.setAIInterval=function(t,e){var i=c.GameTime.Instance.totalGameTime+e,n=this.aiIntevalDic[t];void 0==n&&(n=0),this.aiIntevalDic[t]=Math.max(i,n)},t.prototype.getAI=function(t){var e=this.aiDic[t];return e instanceof Function&&(e=new this.aiDic[t],this.aiDic[t]=e),e},t.prototype.checkClose=function(t,e,i,n,a,o){return Math.abs(t-i)<=a&&Math.abs(e-n)<=o},t.prototype.removeEntityAI=function(t){delete this.aiIntevalDic[t]},t}();i.AIManager=f},{"../../../../data/GameTime":48,"../../fsm/EntityDeadFsm":31,"../../fsm/EntityForceMoveFsm":32,"../../fsm/EntityFreeFsm":33,"../../fsm/EntityMoveFsm":34,"../../fsm/EntityPickupFsm":35,"../../fsm/EntitySkillFsm":36,"./MonsterAI":29,"./PlayerAI":30}],29:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./AIBase"),a=t("../../../../data/GameTime"),o=t("../../fsm/EntitySkillFsm"),r=t("../../../../config/ConfigManager"),s=t("../../../BattleManager"),l=t("../../SkillManager"),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.check=function(e){return 0==t.prototype.check.call(this,e)?0:2==e.curFsm.getState()&&1==e.action?0:3},e.prototype.doSkill=function(t,e,i,n){void 0===n&&(n=1);var a=t,r=l.SkillManager.Instance.createSkill(i);return r.calculate(t,e,i,n,a.config.att),t.prepareSkillData(r),2==t.curFsm.getState()?t.curFsm.enter(t,0):t.changeFSMState(o.EntitySkillFsm.Instance),!0},e.prototype.doSomething=function(t,e){var i=t,n=r.ConfigManager.Instance.monsterSkill[i.mid],a=n.skillId[0],o=n.skillLevel[0];e.a_isDead||this.doSkill(t,e,a,o)},e.prototype.die=function(t){t.deadTime=a.GameTime.Instance.totalGameTime+2e3,t.die()},e.prototype.dieEnd=function(t){t.dieEnd(!0),s.BattleManager.Instance.checkEnemyState()},e}(n.AIBase);i.MonsterAI=c},{"../../../../config/ConfigManager":46,"../../../../data/GameTime":48,"../../../BattleManager":3,"../../SkillManager":17,"../../fsm/EntitySkillFsm":36,"./AIBase":27}],30:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./AIBase"),a=t("../../fsm/EntitySkillFsm"),o=t("../../../../data/GameData"),r=t("../../SkillManager"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.check=function(e){return 0==t.prototype.check.call(this,e)?0:2==e.curFsm.getState()&&1==e.action?0:3},e.prototype.doSkill=function(t,e,i,n){void 0===n&&(n=1);var o=r.SkillManager.Instance.createSkill(i);return o.calculate(t,e,i,n),t.prepareSkillData(o),2==t.curFsm.getState()?t.curFsm.enter(t,0):t.changeFSMState(a.EntitySkillFsm.Instance),!0},e.prototype.die=function(t){o.GameData.instance.sendNotif(7,"玩家死亡-失败"),o.GameData.instance.gameOver()},e}(n.AIBase);i.PlayerAI=s},{"../../../../data/GameData":47,"../../SkillManager":17,"../../fsm/EntitySkillFsm":36,"./AIBase":27}],31:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../entity/EntityManager"),a=function(){function t(){}return t.prototype.getState=function(){return 3},t.prototype.enter=function(t,e){t._entityAI.die(t)},t.prototype.stateChange=function(t,e){return n.EntityManager.Instance.firstPlayer,!1},t.prototype.execute=function(t,e){t.canRelive&&t.freeTime<e.totalGameTime?t._entityAI.relive(t):t.deadTime>0&&t.deadTime<e.totalGameTime&&t._entityAI.dieEnd(t)},t.prototype.exit=function(t){},t}();i.EntityDeadFsm=a},{"../entity/EntityManager":23}],32:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.getState=function(){return 4},t.prototype.enter=function(t,e){t.onEnterForceMove()},t.prototype.stateChange=function(t,e){return!1},t.prototype.execute=function(t,e){t.onExecuteMove(e)},t.prototype.exit=function(t){},t}();i.EntityForceMoveFsm=n},{}],33:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.getState=function(){return 0},t.prototype.enter=function(t,e){t.onEnterFree()},t.prototype.stateChange=function(t,e){return!1},t.prototype.execute=function(t,e){t._entityAI&&t.freeTime<e.totalGameTime&&t._entityAI.check(t)},t.prototype.exit=function(t){},t}();i.EntityFreeFsm=n},{}],34:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../entity/AnimalEntity"),a=function(){function t(){}return t.prototype.getState=function(){return 1},t.prototype.enter=function(t,e){t instanceof n.AnimalEntity&&t.bianshen(null),t.onEnterMove()},t.prototype.stateChange=function(t,e){return!1},t.prototype.execute=function(t,e){t.onExecuteMove(e)},t.prototype.exit=function(t){t.stopTween()},t}();i.EntityMoveFsm=a},{"../entity/AnimalEntity":19}],35:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../../data/GameTime"),a=t("./EntityFreeFsm"),o=function(){function t(){}return t.prototype.getState=function(){return 7},t.prototype.enter=function(t,e){t.onPickup(),t.strategyTick=n.GameTime.Instance.totalGameTime+e},t.prototype.stateChange=function(t,e){return!1},t.prototype.execute=function(t,e){if(!(t.strategyTick>e.totalGameTime)){var i=t;if(!t.isBusy){if(t._entityAI&&0!=t._entityAI.check(i))return;t.changeFSMState(a.EntityFreeFsm.Instance)}}},t.prototype.exit=function(t){},t}();i.EntityPickupFsm=o},{"../../../data/GameTime":48,"./EntityFreeFsm":33}],36:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../../data/GameTime"),a=t("./EntityFreeFsm"),o=function(){function t(){}return t.prototype.getState=function(){return 2},t.prototype.enter=function(t,e){t.onReleaseSkill(),t.strategyTick=n.GameTime.Instance.totalGameTime+e},t.prototype.stateChange=function(t,e){return!1},t.prototype.execute=function(t,e){if(!(t.strategyTick>e.totalGameTime)){var i=t;if(1==i.action&&!t.isBusy){if(t._entityAI&&0!=t._entityAI.check(i))return;t.changeFSMState(a.EntityFreeFsm.Instance)}}},t.prototype.exit=function(t){},t}();i.EntitySkillFsm=o},{"../../../data/GameTime":48,"./EntityFreeFsm":33}],37:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.init=function(){this.shaderDefines2=new laya.d3.shader.ShaderDefines(this.shaderDefines),this.INNER_GLOW=this.shaderDefines2.registerDefine("INNER_GLOW")},Object.defineProperty(e.prototype,"marginalColor",{get:function(){return this._shaderValues.getVector(e.MARGINALCOLOR)},set:function(t){t?this._defineDatas.add(e.INNER_GLOW):this._defineDatas.remove(e.INNER_GLOW),this._shaderValues.setVector(e.MARGINALCOLOR,t)},enumerable:!0,configurable:!0}),e.prototype.setShaderName=function(e){t.prototype.setShaderName.call(this,"customShader")},e.MARGINALCOLOR=24,e}(Laya.BlinnPhongMaterial);i.CustomMaterial=n},{}],38:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../marterial/CustomMaterial"),a=function(){function t(){}return t.initShader=function(){var t={a_Position:Laya.VertexMesh.MESH_POSITION0,a_Color:Laya.VertexMesh.MESH_COLOR0,a_Normal:Laya.VertexMesh.MESH_NORMAL0,a_Texcoord0:Laya.VertexMesh.MESH_TEXTURECOORDINATE0,a_Texcoord1:Laya.VertexMesh.MESH_TEXTURECOORDINATE1,a_BoneWeights:Laya.VertexMesh.MESH_BLENDWEIGHT0,a_BoneIndices:Laya.VertexMesh.MESH_BLENDINDICES0,a_Tangent0:Laya.VertexMesh.MESH_TANGENT0},e={u_Bones:[0,0],u_DiffuseTexture:[1,1],u_SpecularTexture:[3,1],u_NormalTexture:[2,1],u_AlphaTestValue:[0,1],u_DiffuseColor:[5,1],u_MaterialSpecular:[6,1],u_Shininess:[7,1],u_TilingOffset:[8,1],u_WorldMat:[Laya.Sprite3D.WORLDMATRIX,2],u_MvpMatrix:[Laya.Sprite3D.MVPMATRIX,2],u_LightmapScaleOffset:[Laya.RenderableSprite3D.LIGHTMAPSCALEOFFSET,2],u_LightMap:[Laya.RenderableSprite3D.LIGHTMAP,2],u_CameraPos:[0,3],u_ReflectTexture:[22,4],u_ReflectIntensity:[23,4],u_FogStart:[1,4],u_FogRange:[2,4],u_FogColor:[0,4],"u_DirectionLight.Color":[4,4],"u_DirectionLight.Direction":[3,4],"u_PointLight.Position":[5,4],"u_PointLight.Range":[6,4],"u_PointLight.Color":[8,4],"u_SpotLight.Position":[9,4],"u_SpotLight.Direction":[10,4],"u_SpotLight.Range":[12,4],"u_SpotLight.Spot":[11,4],"u_SpotLight.Color":[14,4],u_AmbientColor:[21,4],u_shadowMap1:[18,4],u_shadowMap2:[19,4],u_shadowMap3:[20,4],u_shadowPSSMDistance:[15,4],u_lightShadowVP:[16,4],u_shadowPCFoffset:[17,4],u_marginalColor:[n.CustomMaterial.MARGINALCOLOR,Laya.Shader3D.PERIOD_MATERIAL]};n.CustomMaterial.init();Laya.Shader3D.add("customShader",t,e,Laya.SkinnedMeshSprite3D.shaderDefines,n.CustomMaterial.shaderDefines2).addShaderPass('#include "Lighting.glsl";\n\nattribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\n\tattribute vec2 a_Texcoord0;\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(LIGHTMAP)&&defined(UV1)\n\tattribute vec2 a_Texcoord1;\n#endif\n\n#ifdef LIGHTMAP\n\tuniform vec4 u_LightmapScaleOffset;\n\tvarying vec2 v_LightMapUV;\n#endif\n\n#ifdef COLOR\n\tattribute vec4 a_Color;\n\tvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(INNER_GLOW)\n\tattribute vec3 a_Normal;\n\tvarying vec3 v_Normal; \n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_ViewDir; \n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\tattribute vec4 a_Tangent0;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\tuniform mat4 u_WorldMat;\n\tvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvoid main_castShadow()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform = u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position=skinTransform*a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t#endif\n\t \n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0=a_Texcoord0;\n\t#endif\n\t\tv_posViewZ = gl_Position.z;\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n              b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n              b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\nvoid main_normal()\n{\n\t#ifdef BONE\n\t\tmat4 skinTransform = u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tvec4 position=skinTransform*a_Position;\n\t\tgl_Position = u_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * a_Position;\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tmat3 worldInvMat;\n\t\t#ifdef BONE\n\t\t\tworldInvMat=inverse(mat3(u_WorldMat*skinTransform));\n\t\t#else\n\t\t\tworldInvMat=inverse(mat3(u_WorldMat));\n\t\t#endif  \n\t\tv_Normal=a_Normal*worldInvMat;\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\t\tv_Tangent=a_Tangent0.xyz*worldInvMat;\n\t\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\n\t\t#endif\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)||defined(RECEIVESHADOW)\n\t\t#ifdef BONE\n\t\t\tv_PositionWorld=(u_WorldMat*position).xyz;\n\t\t#else\n\t\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t\t#endif\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(REFLECTMAP)\n\t\tv_ViewDir=u_CameraPos-v_PositionWorld;\n\t#endif\n\n\t#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\t\tv_Texcoord0=a_Texcoord0;\n\t\t#ifdef TILINGOFFSET\n\t\t\tv_Texcoord0=TransformUV(v_Texcoord0,u_TilingOffset);\n\t\t#endif\n\t#endif\n\n\t#ifdef LIGHTMAP\n\t\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t\t#ifdef UV1\n\t\t\t\tv_LightMapUV=vec2(a_Texcoord1.x,1.0-a_Texcoord1.y)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t\t#else\n\t\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,1.0-a_Texcoord0.y)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t\t#endif \n\t\t\tv_LightMapUV.y=1.0-v_LightMapUV.y;\n\t\t#else\n\t\t\t#ifdef UV1\n\t\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t\t#else\n\t\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t\t#endif \n\t\t#endif \n\t#endif\n\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\t\tv_Color=a_Color;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}','#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Lighting.glsl";\n\nuniform vec4 u_DiffuseColor;\n\n#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\tvarying vec4 v_Color;\n#endif\n#if defined(INNER_GLOW)\nuniform vec3 u_marginalColor;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT) || defined(INNER_GLOW)\n\tvarying vec3 v_ViewDir; \n#endif\n\n#ifdef ALPHATEST\n\tuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\n\tuniform sampler2D u_DiffuseTexture;\n#endif\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#ifdef LIGHTMAP\n\tvarying vec2 v_LightMapUV;\n\tuniform sampler2D u_LightMap;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tuniform vec3 u_MaterialSpecular;\n\tuniform float u_Shininess;\n\t#ifdef SPECULARMAP \n\t\tuniform sampler2D u_SpecularTexture;\n\t#endif\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\tuniform sampler2D u_NormalTexture;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#ifdef DIRECTIONLIGHT\n\tuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n\tuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n\tuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(RECEIVESHADOW)\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n\tvec3 globalDiffuse=u_AmbientColor;\n\t#ifdef LIGHTMAP\t\n\t\tglobalDiffuse += DecodeLightmap(texture2D(u_LightMap, v_LightMapUV));\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(INNER_GLOW)\n\t\tvec3 normal;\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent,v_Binormal));\n\t\t#else\n\t\t\tnormal = normalize(v_Normal);\n\t\t#endif\n\t\tvec3 viewDir= normalize(v_ViewDir);\n\t#endif\n\t\n\tvec4 mainColor=u_DiffuseColor;\n\t#ifdef DIFFUSEMAP\n\t\tvec4 difTexColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\t\tmainColor=mainColor*difTexColor;\n\t#endif \n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\t\tmainColor=mainColor*v_Color;\n\t#endif \n    \n\t#ifdef ALPHATEST\n\t\tif(mainColor.a<u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n  \n\t\n\tvec3 diffuse = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tvec3 dif,spe;\n\t\t#ifdef SPECULARMAP\n\t\t\tvec3 gloss=texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n\t\t#else\n\t\t\t#ifdef DIFFUSEMAP\n\t\t\t\tvec3 gloss=vec3(difTexColor.a);\n\t\t\t#else\n\t\t\t\tvec3 gloss=vec3(1.0);\n\t\t\t#endif\n\t\t#endif\n\t#endif\n\n\t\n\t#ifdef DIRECTIONLIGHT\n\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_DirectionLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n \n\t#ifdef POINTLIGHT\n\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_PointLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n\n\t#ifdef SPOTLIGHT\n\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_SpotLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor =vec4(mainColor.rgb*(globalDiffuse + diffuse)*shadowValue,mainColor.a);\n\t#else\n\t\tgl_FragColor =vec4(mainColor.rgb*(globalDiffuse + diffuse),mainColor.a);\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\t#ifdef RECEIVESHADOW\n\t\t\tgl_FragColor.rgb+=specular*shadowValue;\n\t\t#else\n\t\t\tgl_FragColor.rgb+=specular;\n\t\t#endif\n\t#endif\n\t  \n#if defined(INNER_GLOW)\n   float Rim = 1.0 - max(0.0,dot(viewDir, normal));\n   vec3 Emissive = 2.0 * u_DirectionLight.Color * u_marginalColor * pow(Rim,3.0);\n   gl_FragColor = gl_FragColor + vec4(Emissive,1.0);\n#endif\n\t#ifdef FOG\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif  \n}\n'),window.CustomMaterial=n.CustomMaterial},t}();i.CustomShader=a},{"../marterial/CustomMaterial":37}],39:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./SkillBase"),a=t("../util/GameUtils"),o=t("../../../data/GameTime"),r=t("../../../config/ConfigManager"),s=t("../../../utils/Utils"),l=t("../BuffManager"),c=t("../../../data/GameData"),h=function(t){function e(){var e=t.call(this)||this;return e.type=2,e}return __extends(e,t),e.prototype.calculate=function(t,e,i,h,p){void 0===h&&(h=1),void 0===p&&(p=0);r.ConfigManager.Instance.skill[i];var f,u=r.ConfigManager.Instance.skillCondition[i][h];if(u.hurt>0){var d=new n.SkillHurt;d.id=e.id;var m=Math.floor(p*u.rate/1e4)+u.hurt;e.a_trueArmor>0&&(e.a_trueArmor>=m?(l.BuffManager.Instance.subArmor(e,m),e.a_delayArmor=e.a_trueArmor=e.a_trueArmor-m,d.hurt=0):(m-=e.a_trueArmor,l.BuffManager.Instance.subArmor(e,e.a_trueArmor),e.a_delayArmor=e.a_trueArmor=0)),d.effectValue=d.hurt=-m;(e.a_truehp=e.a_truehp+d.hurt)<=0&&(e.a_truehp=0,e.a_isDead=!0,e.a_killer=t.uid,t._entityTargetId=null),this.hurtList||(f=[]),f.push(d)}for(var y,_=0,g=s.utils.splitNumberTwoLevel(u.buffers,"&","#");_<g.length;_++){var v=g[_],I=1==v[0]?e:t,M=v[1];if(I){y||(y=[]);var S=r.ConfigManager.Instance.buff[M],T=new l.BuffVO;T.id=a.IDProvider.getBuffInsID(),T.entityId=I.id,T.endTime=c.GameData.instance.turnId+S.duration,T.buffId=M,T.config=S,0==T.config.trigger&&I?(l.BuffManager.Instance.buffCalculate(T,I),y.push(T)):y.push(T)}}this.from=t,this.prepareSkillData(i,e.id,e.x,e.y,a.DirectionUtil.getForwardByGridXY(t.x,t.y,e.x,e.y),o.GameTime.Instance.totalGameTime,!0,f,y,0)},e}(n.SkillBase);i.MagicSkill=h},{"../../../config/ConfigManager":46,"../../../data/GameData":47,"../../../data/GameTime":48,"../../../utils/Utils":61,"../BuffManager":12,"../util/GameUtils":44,"./SkillBase":41}],40:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function e(){var e=t.call(this)||this;return e.type=1,e}return __extends(e,t),e}(t("./SkillBase").SkillBase);i.NormalHurtSkill=n},{"./SkillBase":41}],41:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../../utils/Utils"),a=t("../../../config/ConfigManager"),o=t("../effect/EffectManager"),r=t("../../../data/GameTime"),s=t("../SkillManager"),l=t("../entity/EntityManager"),c=t("../BuffManager"),h=t("../fsm/EntityDeadFsm"),p=t("../util/GameUtils"),f=function(){function t(){this.enabled=!1,this.end=!1,this.moving=!1,this._showHurt=!1,this.isLj=!1,this._attantion=!0,this._prepareSkill=new u}return t.prototype.calculate=function(t,e,i,n,o){void 0===n&&(n=1),void 0===o&&(o=0);a.ConfigManager.Instance.skill[i];var s,l=a.ConfigManager.Instance.skillCondition[i][n];if(l.hurt>0){var h=new d;h.id=e.id;var f=Math.floor(o*l.rate/1e4)+l.hurt;e.a_trueArmor>0&&(e.a_trueArmor>=f?(c.BuffManager.Instance.subArmor(e,f),e.a_delayArmor=e.a_trueArmor=e.a_trueArmor-f,f=0):(f-=e.a_trueArmor,c.BuffManager.Instance.subArmor(e,e.a_trueArmor),e.a_delayArmor=e.a_trueArmor=0)),h.effectValue=h.hurt=-f;(e.a_truehp=e.a_truehp+h.hurt)<=0&&(e.a_truehp=0,e.a_isDead=!0,e.a_killer=t.uid,t._entityTargetId=null),this.hurtList||(s=[]),s.push(h)}this.from=t,this.prepareSkillData(i,e.id,e.x,e.y,p.DirectionUtil.getForwardByGridXY(t.x,t.y,e.x,e.y),r.GameTime.Instance.totalGameTime,!0,s,null,0)},t.prototype.play=function(){this._prepareSkill.skillid&&(this.release(this._prepareSkill.skillid,this.from,l.EntityManager.Instance.getEntity(this._prepareSkill.toid),this._prepareSkill.x,this._prepareSkill.y,this._prepareSkill.direction,this._prepareSkill.time,this._prepareSkill.showHurt,this._prepareSkill.hurtList,this._prepareSkill.buffList),this.from&&(this.from.busy=this._prepareSkill.busyTime),this._prepareSkill.skillid=null)},t.prototype.prepareSkillData=function(t,e,i,n,a,o,r,s,l,c){void 0===s&&(s=null),void 0===l&&(l=null),void 0===c&&(c=1e3),this._prepareSkill.skillid=t,this._prepareSkill.toid=e,this._prepareSkill.x=i,this._prepareSkill.y=n,this._prepareSkill.direction=a,this._prepareSkill.hurtList=s,this._prepareSkill.buffList=l,this._prepareSkill.time=o,this._prepareSkill.showHurt=r,this._prepareSkill.busyTime=c},t.prototype.release=function(t,e,i,n,o,r,s,l,c,h){this.from=e,this.target=i,this.target?(this.targetX=i.x,this.targetY=i.y):(this.targetX=n,this.targetY=o),this.enabled=!0,this._showHurt=l,this.hurtList=c,this.buffList=h,this.skillid=t,this.config=a.ConfigManager.Instance.skill[t],this.end=!1,this.releaseTime=s,e&&(0==this.config.action&&e.setAction(4,r,!0),this.from.bianshen(null)),this.initEffects(),this.buffList&&this.addBufferList(this.buffList)},t.prototype.initEffects=function(){var t=this.from;t&&1==t.group?this._needSound=!0:this._needSound=!1;var e,i,n=a.ConfigManager.Instance.skillEffects[this.skillid];if(n){for(var o=0,r=n;o<r.length;o++){var s=r[o];0==s.type||(1==s.type?(i||(i=[]),i.push(s)):2==s.type&&(e=s))}this.targetEffect=i,e&&t?(this.moving=!0,this.flyComplete()):(this.moving=!1,this.playTargetEffects())}else this.targetEffect=void 0},t.prototype.flyComplete=function(){this.releaseTime=r.GameTime.Instance.totalGameTime,this.moving=!1,this.playTargetEffects(60)},t.prototype.playTargetEffects=function(t){void 0===t&&(t=0);if(this.targetEffect)for(var e=0,i=this.targetEffect;e<i.length;e++)i[e]},t.prototype.update=function(t){this.end?(s.SkillManager.Instance.readyToDie(this),this.enabled=!1):!this.moving&&t.totalGameTime>this.config.hurtDelay+this.releaseTime&&(this.playHurtList(this.hurtList,t),this.end=!0)},t.prototype.addBufferList=function(t){for(var e=l.EntityManager.Instance.getAllEntity(),i=0,n=t;i<n.length;i++){var a=n[i],o=e[a.entityId];c.BuffManager.Instance.addBuff(o,a)}},t.prototype.playHurtList=function(t,e){if(t)for(var i=l.EntityManager.Instance.getAllEntity(),n=0,a=0,r=t;a<r.length;a++){var s=r[a];n++;var c=i[s.id.toString()];if((0!=s.hurt||0!=s.effectValue)&&(c&&c.enabled)){if(this._showHurt&&0!=s.effectValue&&this.from){var p=0;this.from&&this.from.enabled&&(this.from.x>c.x?p=1:this.from.x<c.x&&(p=2));if(this._attantion||1==c.group){c.showBloodEffect(s.effectValue,p,0,s.plus,n);var f=c.display.transform;o.EffectManager.Instance.addEffect(1,f.position.x,f.position.y,f.position.z,3e3)}}c.a_delayhp+=s.hurt,c.a_delayhp=c.a_delayhp<0?0:c.a_delayhp,0!=s.hurt&&c.setBlood(c.a_delayhp,c.a_maxHp,!0),0==c.a_delayhp&&c.a_isDead&&c.changeFSMState(h.EntityDeadFsm.Instance)}}},t.prototype.dispose=function(){if(this.enabled=!1,this.targetEffect=void 0,this.from=void 0,this.target=void 0,this.isLj=!1,this.targetX=void 0,this.targetY=void 0,this.skillid=void 0,this.hurtList){for(var t=0,e=this.hurtList;t<e.length;t++){e[t].dispose()}this.hurtList=null}s.SkillManager.Instance.returnSkill(this)},t}();i.SkillBase=f;var u=function(){return function(){}}();i.SkillResult=u;var d=function(){function t(){}return t.create=function(t,e,i,n,a){void 0===a&&(a=0);var o=this.pool.pop();return o.id=t,o.hurt=e,o.effectValue=i,o.plus=n,o.armor=a,o},t.prototype.dispose=function(){this.id&&(t.pool.push(this),this.id=null)},t.prototype.disposePermanent=function(){},t.prototype.returnToPool=function(){},t.pool=new n.LimitedPool(t,100),t}();i.SkillHurt=d},{"../../../config/ConfigManager":46,"../../../data/GameTime":48,"../../../utils/Utils":61,"../BuffManager":12,"../SkillManager":17,"../effect/EffectManager":18,"../entity/EntityManager":23,"../fsm/EntityDeadFsm":31,"../util/GameUtils":44}],42:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../util/GameUtils"),a=function(){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=5),this._lasttime=0,this.enabled=!0,this._tweenAble=t,this.speed=e,this._moveIncrement=[]}return Object.defineProperty(t.prototype,"end",{get:function(){return this._end},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tweenAble",{get:function(){return this._tweenAble},set:function(t){this._tweenAble=t},enumerable:!0,configurable:!0}),t.prototype.setSpeed=function(t){this.enabled&&(this.speed=t,n.Vector2Extension.moveIncrementByPoint(this._moveIncrement,this._start,this._end,this.speed))},t.prototype.initialize=function(){this.enabled=!1},t.prototype.move=function(t){this.resetTween(),this._movePoint=[this._tweenAble.x,this._tweenAble.z],this._start=[this._tweenAble.x,this._tweenAble.z],this._end=t,this._direction=n.Vector2Extension.directionByTan(this._start[0],this._start[1],this._end[0],this._end[1]),n.Vector2Extension.moveIncrementByPoint(this._moveIncrement,this._start,this._end,this.speed),this._betweenDistance=n.Vector2Extension.distanceOfPoint(this._start,this._end),this.enabled=!0,null!=this.moveBegin&&this.moveBegin(this._direction)},t.prototype.updateTime=function(t){var e=t.elapsedGameTime/(1e3/60);e>6&&(e=6),this._moveDistance+=this.speed*e,this._movePoint[0]+=this._moveIncrement[0]*e,this._movePoint[1]+=this._moveIncrement[1]*e,this.enabled&&(this._moveDistance>=this._betweenDistance||this._tweenAble.endNow)?(this._tweenAble.moveNext||(this._movePoint[0]=this._end[0],this._movePoint[1]=this._end[1]),this._tweenAble.setHorizontalPosition(this._movePoint[0],this._movePoint[1]),this.enabled=!1,this.resetTween(),null!=this.moveComplete&&this.moveComplete(this._tweenAble,t.totalGameTime)):(this._tweenAble.setHorizontalPosition(this._movePoint[0],this._movePoint[1]),null!=this.moveStep&&this.moveStep())},t.prototype.resetTween=function(){this.enabled=!1,this._moveDistance=0,this._betweenDistance=0,this._moveIncrement=[],this._movePoint=null,this._start=null,this._end=null},t.prototype.stop=function(){this.resetTween()},t.prototype.dispose=function(){this.moveBegin=null,this.moveStep=null,this.moveComplete=null,this._moveIncrement=null,this._movePoint=null,this._start=null,this._end=null,this._tweenAble=null,this.speed=NaN,this._betweenDistance=NaN,this._moveDistance=NaN},t}();i.Tween=a},{"../util/GameUtils":44}],43:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(){}return t.createBp=function(t){var e=this.bpPool.length>0?this.bpPool.pop():new Laya.Sprite;return t&&(e.texture=t),e.width=e.height=NaN,e.x=e.y=0,e.scaleX=e.scaleY=1,e},t.pushBp=function(t){this.bpPool.length<100&&this.bpPool.push(t)},t.bpPool=[],t}();i.default=n},{}],44:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../GameDefine"),a=function(){function t(){}return t.getEntityInsID=function(){return++this.__entityId},t.getEffectInsID=function(){return this.__effectId++,this.__effectId},t.getSkillInsID=function(){return this.__skillId++,this.__skillId},t.getBuffInsID=function(){return this.__buffId++,this.__buffId},t.getCardInsID=function(){return this.__cardId++,this.__cardId},t.__entityId=0,t.__effectId=0,t.__skillId=0,t.__buffId=0,t.__cardId=0,t}();i.IDProvider=a;var o=function(){function t(){}return t.setQuaternion=function(t,e){var i=t.transform.localRotation;i.elements[0]=e.elements[0],i.elements[1]=e.elements[1],i.elements[2]=e.elements[2],i.elements[3]=e.elements[3],t.transform.localRotation=i},t.ConvertDirToVector3=function(t){return t=t/180*Math.PI,new Laya.Vector3(Math.cos(t),0,Math.sin(t))},t.Vector3Temp=new Laya.Vector3(0,0,0),t.Vector3Temp2=new Laya.Vector3(0,0,0),t.Vector3Temp3=new Laya.Vector3(0,0,0),t.Vector3UpTemp=new Laya.Vector3(0,1,0),t.tempQuaternion=new Laya.Quaternion(0,0,0,0),t}();i.GameUtils=o;var r=function(){function t(){}return t.orientation=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return 180*Math.atan2(n,i)/Math.PI},t.blowFlyEffects=function(t,e,i,n,a){var o=180*Math.atan((n-e)/(i-t))/Math.PI,r=t>i?-1:1,s=e>n?-1:1,l=Math.abs(Math.cos(o*Math.PI/180))*a*r+i,c=Math.abs(Math.sin(o*Math.PI/180))*a*s+n;return t==i&&(l=i,c=a*s+n),e==n&&(l=a*r+i,c=n),[l,c]},t.moveIncrement=function(e,i,n){var a=n/t.distanceOfPoint(e,i);return[(i[0]-e[0])*a,(i[1]-e[1])*a]},t.moveIncrementByPoint=function(e,i,n,a){var o=a/t.distanceOfPoint(i,n),r=(n[0]-i[0])*o,s=(n[1]-i[1])*o;e[0]=r,e[1]=s},t.moveDistance=function(e,i,n){var a=n/t.distanceOfPoint(e,i);return[Math.floor(e[0]+(i[0]-e[0])*a),Math.floor(e[1]+(i[1]-e[1])*a)]},t.directionPointByTan=function(e,i){return t.directionByTan(e[0],e[1],i[0],i[1])},t.distanceOfPoint=function(t,e){var i=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(i*i+n*n)},t.directionByTan=function(e,i,n,a){var o=(a-i)/(n-e);return Math.abs(o)>=Math.tan(3*Math.PI/8)&&a<=i?8:Math.abs(o)>Math.tan(Math.PI/8)&&Math.abs(o)<Math.tan(3*Math.PI/8)&&n>e&&a<i?9:Math.abs(o)<=Math.tan(Math.PI/8)&&n>=e?6:Math.abs(o)>Math.tan(Math.PI/8)&&Math.abs(o)<Math.tan(3*Math.PI/8)&&n>e&&a>i?3:Math.abs(o)>=Math.tan(3*Math.PI/8)&&a>=i?2:Math.abs(o)>Math.tan(Math.PI/8)&&Math.abs(o)<Math.tan(3*Math.PI/8)&&n<e&&a>i?1:Math.abs(o)<=Math.tan(Math.PI/8)&&n<=e?4:Math.abs(o)>Math.tan(Math.PI/8)&&Math.abs(o)<Math.tan(3*Math.PI/8)&&n<e&&a<i?7:t.RandomExtract([1,2,3,4,6,7,8,9])},t.RandomExtract=function(t){return t[Math.floor(Math.random()*t.length)]},t}();i.Vector2Extension=r;var s=function(){function t(){}return t.getForwardByPoints=function(t,e,i,a){var o=i-t,r=a-e,s=o/Math.sqrt(o*o+r*r),l=Math.floor(180*Math.acos(s)/Math.PI);return r<0&&(l=360-l),l>337||l<23?n.DirectionType.RIGHT:l>292?n.DirectionType.RIGHT_UP:l>247?n.DirectionType.UP:l>202?n.DirectionType.LEFT_UP:l>157?n.DirectionType.LEFT:l>112?n.DirectionType.LEFT_DOWN:l>67?n.DirectionType.DOWN:n.DirectionType.RIGHT_DOWN},t.getRotateByDir=function(t){var e;switch(t){case n.DirectionType.UP:e=0;break;case n.DirectionType.RIGHT_UP:e=56/180*Math.PI;break;case n.DirectionType.RIGHT:e=.5*Math.PI;break;case n.DirectionType.RIGHT_DOWN:e=124/180*Math.PI;break;case n.DirectionType.DOWN:e=1*Math.PI;break;case n.DirectionType.LEFT_DOWN:e=236/180*Math.PI;break;case n.DirectionType.LEFT:e=1.5*Math.PI;break;case n.DirectionType.LEFT_UP:e=304/180*Math.PI}return e},t.getRotateByDir2=function(t){var e;switch(t){case n.DirectionType.UP:e=180;break;case n.DirectionType.RIGHT_UP:e=-124;break;case n.DirectionType.RIGHT:e=-90;break;case n.DirectionType.RIGHT_DOWN:e=-56;break;case n.DirectionType.DOWN:e=0;break;case n.DirectionType.LEFT_DOWN:e=56;break;case n.DirectionType.LEFT:e=90;break;case n.DirectionType.LEFT_UP:e=124}return e},t.getForwardByGridXY=function(e,i,n,a){return t.getDir(n-e,a-i)},t.getDir=function(t,e){return t>0?e<0?n.DirectionType.RIGHT_UP:e>0?n.DirectionType.RIGHT_DOWN:n.DirectionType.RIGHT:t<0?e<0?n.DirectionType.LEFT_UP:e>0?n.DirectionType.LEFT_DOWN:n.DirectionType.LEFT:e<0?n.DirectionType.UP:n.DirectionType.DOWN},t.getNearDirs=function(t){for(var e=0,i=n.DirectionType.EIGHT_DIRS,a=[],o=0;o<8;o++)if(i[o]==t){e=o;break}for(var r=1;r<=4&&(null!=i[e+r]?a.push(i[e+r]):a.push(i[e+r-8]),4!=r);r++)null!=i[e-r]?a.push(i[e-r]):a.push(i[e-r+8]);return a},t.addNode=function(t,e,i,a){void 0===a&&(a=1);var o=[t,e];switch(i){case n.DirectionType.UP:o[0]=o[1]-a;break;case n.DirectionType.RIGHT_UP:o[1]=o[1]-a,o[0]=o[0]+a;break;case n.DirectionType.RIGHT:o[0]=o[0]+a;break;case n.DirectionType.RIGHT_DOWN:o[1]=o[1]+a,o[0]=o[0]+a;break;case n.DirectionType.DOWN:o[1]=o[1]+a;break;case n.DirectionType.LEFT_DOWN:o[1]=o[1]+a,o[0]=o[0]-a;break;case n.DirectionType.LEFT:o[0]=o[0]-a;break;case n.DirectionType.LEFT_UP:o[1]=o[1]-a,o[0]=o[0]-a}return o},t.addDir=function(t,e){(e%=8)<0&&(e=8+e);var i=t+e;return i>7&&(i-=8),i},t.getVecDir=function(t){switch(t){case n.DirectionType.UP:case n.DirectionType.RIGHT_UP:case n.DirectionType.LEFT_UP:return n.DirectionType.UP;case n.DirectionType.RIGHT_DOWN:case n.DirectionType.DOWN:case n.DirectionType.LEFT_DOWN:return n.DirectionType.DOWN}return-1},t.getHorDir=function(t){switch(t){case n.DirectionType.RIGHT_UP:case n.DirectionType.RIGHT:case n.DirectionType.RIGHT_DOWN:return n.DirectionType.RIGHT;case n.DirectionType.LEFT_DOWN:case n.DirectionType.LEFT:case n.DirectionType.LEFT_UP:return n.DirectionType.LEFT}return-1},t.orientation=function(t,e,i,n){var a=i-t,o=n-e;return 180*Math.atan2(o,a)/Math.PI},t}();i.DirectionUtil=s},{"../GameDefine":14}],45:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../../../config/ConfigManager"),a=function(){function t(){this._references={},this._loading={},this._resArr={}}return t.prototype.addRefByObjId=function(t,e){void 0===e&&(e="model_");var i=n.ConfigManager.Instance.obj[e+t];if(i){for(var a=0,o=i.allRes;a<o.length;a++){var r=o[a];this.addRef(r)}this.addRef(i.url)}},t.prototype.removeRefByObjId=function(t,e){void 0===e&&(e="model_");var i=n.ConfigManager.Instance.obj[e+t];if(i){this.removeRef(i.url);for(var a=0,o=i.allRes;a<o.length;a++){var r=o[a];this.removeRef(r)}}},t.prototype.checkRef=function(t,e){void 0===e&&(e="model_");var i=n.ConfigManager.Instance.obj[e+t];if(i){for(var a=0,o=i.allRes;a<o.length;a++){var r=o[a];this._references[r]<=0&&this.disposeRes(r)}this.disposeRes(i.url)}},t.prototype.addRef=function(t){null==this._references[t]?this._references[t]=1:this._references[t]++},t.prototype.removeRef=function(t){this._references[t]&&(this._references[t]--,this._references[t]<=0&&this.disposeRes(t))},t.prototype.disposeRes=function(t){var e=Laya.loader.getRes(t);e?e instanceof Laya.Sprite3D?(e.destroy(),Laya.loader.clearRes(t)):(e.destroy(),e.releaseResource&&e.releaseResource(!0),Laya.loader.clearRes(t)):Laya.loader.cancelLoadByUrl(t)},t.prototype.addToLoading=function(t){this._loading[t]?this._loading[t]+=1:this._loading[t]=1},t.prototype.removeLoad=function(t){return!!this._loading[t]&&(this._loading[t]-=1,0==this._loading[t]?(delete this._loading[t],!0):(this._loading[t]<0&&(console.error(t+"引用计数出错！"),delete this._loading[t]),!1))},t.prototype.disposeLoadedUrl=function(t){if(!this._loading[t]&&t){var e=this._resArr[t];if(e)for(var i=0,n=e.length;i<n;i++){var a=e[i];this.disposeRes(a)}}},t.prototype.addMesh3DRes=function(t,e){if(e&&t&&!t.destroyed){if(t instanceof Laya.SkinnedMeshSprite3D||t instanceof Laya.MeshSprite3D){var i=t;if(i&&i.meshFilter){var n=i.meshFilter.sharedMesh;n&&this.pushUrl(e,n.url)}if(i&&i._render)for(var a=i._render._materials,o=0,r=a.length;o<r;o++){var s=a[o];s&&(s.url?this.pushUrl(e,s.url):console.error("找不到材质资源resUrl"),s.albedoTexture&&this.pushUrl(e,s.albedoTexture.url),s.specularTexture&&this.pushUrl(e,s.specularTexture.url),s.normalTexture&&this.pushUrl(e,s.normalTexture.url),s.wingTexture&&this.pushUrl(e,s.wingTexture.url),s.maskTexture&&this.pushUrl(e,s.maskTexture.url))}}else if(t instanceof Laya.ShuriKenParticle3D){var l=t;if(l&&l._render){var c=l._render;c.mesh&&this.pushUrl(e,c.mesh.url);for(var h=c._materials,o=0,r=h.length;o<r;o++){var p=h[o];p.url&&this.pushUrl(e,p.url),p&&p.texture&&this.pushUrl(e,p.texture._url)}}}else if(t instanceof Laya.Sprite3D){var f=t.getComponent(Laya.Animator);if(f){var u=f.avatar;u&&u.url&&this.pushUrl(e,u.url);var d=f._controllerLayers;if(d)for(var m=0;m<d.length;m++){var y=d[m];if(y._states)for(var _=0;_<y._states.length;_++){var g=y._states[_];g._clip&&this.pushUrl(e,g._clip._url)}}}}for(o=0;o<t.numChildren;o++){var v=t.getChildAt(o);v&&!v.destroyed&&this.addMesh3DRes(v,e)}}},t.prototype.analysisUrl=function(t){var e=this._resArr[t];if(!e){var i=Laya.loader.getRes(t),n=[];n.push(t),this.addMesh3DRes(i,n),e=this._resArr[t]=n}return e},t.prototype.pushUrl=function(t,e){e&&-1==t.indexOf(e)&&t.push(e)},t.prototype.addReferenceRes=function(t){if(t)for(var e=this.analysisUrl(t),i=0,n=e.length;i<n;i++){var a=e[i];this._references[a]?this._references[a]+=1:this._references[a]=1}},t.prototype.removeReferenceRes=function(t){if(t){var e=this._resArr[t];if(e)for(var i=0,n=e.length;i<n;i++){var a=e[i];this._references[a]&&(this._references[a]-=1,0==this._references[a]?(this.disposeRes(a),delete this._references[a]):this._references[a]<0&&(console.error(a+"资源释放错误"),delete this._references[a]))}}},t.Instance=new t,t}();i.ResDisposer=a},{"../../../config/ConfigManager":46}],46:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../utils/Utils"),a=function(){function t(){this.skill={},this.skillCondition={},this.card={},this.skillEffects={},this.bufferEffects={},this.buff={},this.monsterSkill={},this.monster={},this.level={}}return t.prototype.loadConfig=function(t){this.tables=[{url:"config/cfg_card.csv",item:this.card,cls:r,reader:this.setConf},{url:"config/cfg_buff.csv",item:this.buff,cls:h,reader:this.setConf},{url:"config/cfg_skill_effects.csv",item:this.skillEffects,cls:o,reader:this.addSkillEffect},{url:"config/cfg_skills.csv",item:this.skill,cls:l,reader:this.setConf},{url:"config/cfg_skills_condition.csv",item:this.skillCondition,cls:c,reader:this.addSkillCondition},{url:"config/cfg_monsters.csv",item:this.monster,cls:p,reader:this.setConf},{url:"config/cfg_monster_skill.csv",item:this.monsterSkill,cls:f,reader:this.addMonsterSkill},{url:"config/map.json",type:"json",item:"map"},{url:"config/obj.json",type:"json",item:"obj"}];var e=[];this.tables.forEach(function(t){var i="json"==t.type?Laya.Loader.JSON:Laya.Loader.TEXT;e.push({url:t.url,type:i})}),Laya.loader.create(e,Laya.Handler.create(this,this.configLoaded,[t]),null)},t.prototype.configLoaded=function(t){var e=this;this.tables.forEach(function(t){var i=Laya.loader.getRes(t.url);"json"==t.type?e[t.item]=i:t.reader.call(e,i,t.cls,t.item)}),t&&t()},t.prototype.addMonsterSkill=function(t,e,i){for(var a,o,r=[],s=t.split("\n"),l=1;l>0;)l--,s.shift();var c=s[0],h=s[1];a=h.trim().split(","),o=c.trim().split(",");a.length;for(var p=null,f=2;f<s.length;f++){(u=s[f])&&(p=u.trim().split(","),r.push(p))}for(f=0;f<r.length;f++){for(var u=r[f],d=new e,m=0;m<a.length;m++){var y=a[m],_=o[m];"str"==_?d[y]=u[m]:""!=_&&(d[y]=Number(u[m]))}i[d.monsterId]=d,d.skillId=n.utils.splitNumber(d.skillId,"#"),d.skillLevel=n.utils.splitNumber(d.skillLevel,"#"),d.hpPercentMax=n.utils.splitNumber(d.hpPercentMax,"#"),d.hpPercentMin=n.utils.splitNumber(d.hpPercentMin,"#"),d.priority=n.utils.splitNumber(d.priority,"#")}},t.prototype.setConf=function(t,e,i){for(var n,a,o=[],r=t.split("\n"),s=1;s>0;)s--,r.shift();var l=r[0],c=r[1];n=c.trim().split(","),a=l.trim().split(",");n.length;for(var h=null,p=2;p<r.length;p++){(f=r[p])&&(h=f.trim().split(","),o.push(h))}for(p=0;p<o.length;p++){for(var f=o[p],u=new e,d=0;d<n.length;d++){var m=n[d],y=a[d];"str"==y?u[m]=f[d]:""!=y&&(u[m]=Number(f[d]))}i[u.id]=u}},t.prototype.addSkillCondition=function(t,e,i){for(var n,a,o=[],r=t.split("\n"),s=1;s>0;)s--,r.shift();var l=r[0],c=r[1];n=c.trim().split(","),a=l.trim().split(",");n.length;for(var h=null,p=2;p<r.length;p++){(f=r[p])&&(h=f.trim().split(","),o.push(h))}for(p=0;p<o.length;p++){for(var f=o[p],u=new e,d=0;d<n.length;d++){var m=n[d],y=a[d];u[m]="str"==y?f[d]:Number(f[d])}var _=this.skillCondition;u.skillid in _||(_[u.skillid]={}),_[u.skillid][u.level]=u}},t.prototype.addSkillEffect=function(t,e,i){for(var n,a,o=[],r=t.split("\n"),s=1;s>0;)s--,r.shift();var l=r[0],c=r[1];n=c.trim().split(","),a=l.trim().split(",");n.length;for(var h=null,p=2;p<r.length;p++){(f=r[p])&&(h=f.trim().split(","),o.push(h))}for(p=0;p<o.length;p++){for(var f=o[p],u=new e,d=0;d<n.length;d++){var m=n[d],y=a[d];u[m]="str"==y?f[d]:Number(f[d])}var _=this.skillEffects,g=this.bufferEffects;0==u.efftype?(u.skillid in _||(_[u.skillid]=[]),_[u.skillid].push(u)):1==u.efftype&&(u.skillid in g||(g[u.skillid]=[]),g[u.skillid].push(u))}},t.Instance=new t,t}();i.ConfigManager=a;var o=function(){return function(){}}();i.SkillEffectConfig=o;var r=function(){return function(){}}();i.CardConfig=r;var s=function(){return function(){}}();i.RoleConfig=s;var l=function(){return function(){}}();i.SkillConfig=l;var c=function(){return function(){}}();i.SkillConditionConfig=c;var h=function(){return function(){}}();i.BuffConfig=h;var p=function(){return function(){}}();i.MonsterConfig=p;var f=function(){return function(){}}();i.MonsterSkillConfig=f},{"../utils/Utils":61}],47:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../config/ConfigManager"),a=t("../utils/Pool"),o=t("../battle/core/util/GameUtils"),r=t("../utils/Utils"),s=function(){function t(){this._observers=[],this.turnId=0,this.result=1,this.myTurn=!0,this.playerCardPool=[10001,10002,10001,10002,10001,10002,10001,10002,10001,10001],this.mapid=1,this._gameOver=!1,this._hp=100,this._mp=3,this._gold=0,this.oppState=0}return t.prototype.addObserver=function(t){-1==this._observers.indexOf(t)&&this._observers.push(t)},t.prototype.removeObserver=function(t){var e=this._observers.indexOf(t);e>-1&&this._observers.splice(e,1)},t.prototype.sendNotif=function(t,e){for(var i=0,n=this._observers;i<n.length;i++){n[i].updateData(t,e)}},t.prototype.gameOver=function(){this._gameOver=!0},t.prototype.win=function(){this.rewards={cards:[10001,10002,10003],gold:100},this.sendNotif(9,this.rewards)},t.prototype.getReward=function(t){this.playerCardPool.push(t)},t.prototype.clearCardArray=function(t){for(;t.length>0;){t.pop().returnToPool()}},t.prototype.prepareCardPile=function(){this.cardPile||(this.cardPile=[]),this.handCards||(this.handCards=[]),this.discardCards||(this.discardCards=[]),this.destroyCards||(this.destroyCards=[]);for(var t=r.utils.shuffleClone(this.playerCardPool),e=0;e<t.length;e++){var i=t[e],a=l.create();a.config=n.ConfigManager.Instance.card[i],this.cardPile.push(a)}},t.prototype.drawCards=function(){for(var t=this.handCards,e=this.cardPile,i=this.discardCards;t.length<5&&(0==e.length&&i.length>0&&(r.utils.shuffleClone(i,e),i.length=0),e.length>0);)t.push(e.pop())},t.prototype.dropCards=function(){for(;this.handCards.length>0;)this.discardCards.push(this.handCards.pop());this.sendNotif(6)},Object.defineProperty(t.prototype,"mp",{get:function(){return this._mp},set:function(t){this._mp=t,this.sendNotif(1,t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hp",{get:function(){return this._hp},set:function(t){this._hp=t,this.sendNotif(2,t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gold",{get:function(){return this._gold},set:function(t){this._gold=t,this.sendNotif(3,t)},enumerable:!0,configurable:!0}),t.prototype.addHandCard=function(t){this.handCards.push(t)},t.prototype.useHandCard=function(t){for(var e=0;e<this.handCards.length;e++){var i=this.handCards[e];if(i.id==t){this.handCards.splice(e,1),this.discardCards.push(i);break}}t==this.selectedCard.id&&(this.selectedCard=null),this.sendNotif(4,t)},t.prototype.clearLevel=function(){this.cardPile&&this.clearCardArray(this.cardPile),this.handCards&&this.clearCardArray(this.handCards),this.discardCards&&this.clearCardArray(this.discardCards),this.destroyCards&&this.clearCardArray(this.destroyCards),this.sendNotif(6)},t.prototype.resetGame=function(){this.hp=100,this.mp=3,this.gold=0,this._gameOver=!1,this.playerCardPool=[10001,10002,10001,10002,10001,10002,10001,10002,10001,10001]},t.instance=new t,t}();i.GameData=s;var l=function(){function t(){this.level=1}return t.create=function(){var t=this.pool.pop();return t.id=o.IDProvider.getCardInsID(),t.level=1,t},t.prototype.returnToPool=function(){t.pool.push(this)},t.pool=new a.Pool(t),t}();i.CardIns=l},{"../battle/core/util/GameUtils":44,"../config/ConfigManager":46,"../utils/Pool":60,"../utils/Utils":61}],48:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(){this.elapsedGameTime=0,this.totalGameTime=0}return t.createInstance=function(){this.Instance=new t},t.prototype.getNow=function(){return Date.now()-this.startTime},t.prototype.update=function(){var t=Date.now()-this.startTime,e=this.totalGameTime;this.elapsedGameTime=t-e,this.totalGameTime=t},t}();i.GameTime=n},{}],49:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./../script/SelectHeroUI"),a=t("./../script/GameUI"),o=t("./../script/BattleScene"),r=function(){function t(){this.gameState=0}return t.prototype.changeGameState=function(t){switch(this.gameState=t,t){case 1:(new a.default).open(!0);break;case 2:(new n.default).open(!0);break;case 3:(new o.default).open(!0)}},t}();i.GameStateManager=r},{"./../script/BattleScene":50,"./../script/GameUI":53,"./../script/SelectHeroUI":55}],50:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./BattleUI"),a=t("./../ui/layaMaxUI"),o=t("./../battle/BattleManager"),r=t("../data/GameData"),s=t("./WinDialog"),l=t("./GameOverDialog"),c=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.battleScene=this.addChild(new Laya.Sprite),this.mouseEnabled=!0,this.ui=this.addChild(new n.default),o.BattleManager.Instance.init(this.battleScene)},e.prototype.updateData=function(t,e){switch(t){case 8:this.gameOverDialog||(this.gameOverDialog=new l.GameOverDialog),this.gameOverDialog.isModal=!0,this.gameOverDialog.show(!1);break;case 9:this.winDialog||(this.winDialog=new s.WinDialog),this.winDialog.isModal=!0,this.winDialog.show(!1)}},e.prototype.onAwake=function(){r.GameData.instance.addObserver(this)},e.prototype.clickHandler=function(t){},e.prototype.onDestroy=function(){r.GameData.instance.removeObserver(this)},e}(a.ui.test.BattleSceneUI);i.default=c},{"../data/GameData":47,"./../battle/BattleManager":3,"./../ui/layaMaxUI":57,"./BattleUI":51,"./GameOverDialog":52,"./WinDialog":56}],51:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./../ui/layaMaxUI"),a=t("./../battle/BattleManager"),o=t("../data/GameData"),r=t("../utils/FilterUtil"),s=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.updateData=function(t,e){switch(t){case 0:switch(e){case 1:this.log("准备开始"),this.txt_battleState.text="准备开始";break;case 2:this.log("我的回合"),this.txt_battleState.text="我的回合",this.txt_pile.text=""+o.GameData.instance.cardPile.length,this.txt_discard.text=""+o.GameData.instance.discardCards.length,this.txt_destroy.text=""+o.GameData.instance.destroyCards.length,this.list_my.array=o.GameData.instance.handCards;break;case 3:this.log("对方回合"),this.txt_battleState.text="对方回合";break;case 5:this.log("回合结束"),this.txt_battleState.text="回合结束";break;case 4:this.log("回合开始"),this.txt_battleState.text="回合开始"}break;case 4:this.list_my.selectedIndex=-1,this.txt_discard.text=""+o.GameData.instance.discardCards.length,this.txt_destroy.text=""+o.GameData.instance.destroyCards.length;break;case 6:this.list_my.refresh(),this.txt_pile.text=""+o.GameData.instance.cardPile.length;break;case 1:this.txt_mp.text=o.GameData.instance.mp+"";break;case 7:this.log(e)}},e.prototype.log=function(t){this.txt_console.text+="\n"+t,this.txt_console.vScrollBar.value=this.txt_console.vScrollBar.max},e.prototype.onAwake=function(){var t=this.list_my;t.itemRender=n.ui.ui.CardRenderSkinUI,t.hScrollBarSkin="",t.selectEnable=!0,t.selectHandler=new Laya.Handler(this,this.onSelect),t.renderHandler=new Laya.Handler(this,this.updateItem),this.btn_send.on(Laya.Event.CLICK,this,this.clickHandler),this.btn_end.on(Laya.Event.CLICK,this,this.clickHandler),o.GameData.instance.addObserver(this)},e.prototype.updateItem=function(t,e){var i=o.GameData.instance.handCards[e];i?(t.txt_desc.text=i.config.desc,t.txt_name.text=i.config.name,t.txt_mp.text=i.config.mp,o.GameData.instance.selectedCard==i?t.filters=[r.FilterUtil.FILTER_GREEN()]:t.filters=null,t.visible=!0):t.visible=!1},e.prototype.onSelect=function(t){console.log("当前选择的索引："+t),t>=0&&(o.GameData.instance.selectedCard=o.GameData.instance.handCards[t]),this.list_my.refresh()},e.prototype.clickHandler=function(t){t.currentTarget==this.btn_end?a.BattleManager.Instance.endMyTurn():t.currentTarget==this.btn_send&&(a.BattleManager.Instance.destroyScene(),a.BattleManager.Instance.init(null))},e.prototype.onDestroy=function(){o.GameData.instance.removeObserver(this)},e}(n.ui.ui.BattleUISkinUI);i.default=s},{"../data/GameData":47,"../utils/FilterUtil":58,"./../battle/BattleManager":3,"./../ui/layaMaxUI":57}],52:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../ui/layaMaxUI"),a=t("../battle/BattleManager"),o=t("../data/GameData"),r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onAwake=function(){this.btn_go.on(Laya.Event.CLICK,this,this.clickHandler)},e.prototype.clickHandler=function(t){o.GameData.instance.resetGame(),a.BattleManager.Instance.destroyScene(),a.BattleManager.Instance.init(null),this.close()},e.prototype.onDestroy=function(){this.btn_go.off(Laya.Event.CLICK,this,this.clickHandler)},e}(n.ui.ui.GameOverDialogSkinUI);i.GameOverDialog=r},{"../battle/BattleManager":3,"../data/GameData":47,"../ui/layaMaxUI":57}],53:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./../ui/layaMaxUI"),a=t("../manager/GameStateManager"),o=t("../config/ConfigManager"),r=function(t){function e(){var e=t.call(this)||this;return o.ConfigManager.Instance.loadConfig(e.configLoaded),e}return __extends(e,t),e.prototype.configLoaded=function(){a.GameStateManager.Instance.changeGameState(2)},e.prototype.clickHandler=function(t){},e}(n.ui.test.TestSceneUI);i.default=r},{"../config/ConfigManager":46,"../manager/GameStateManager":49,"./../ui/layaMaxUI":57}],54:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onAwake=function(){this.scaleTime=100,this.owner.on(Laya.Event.MOUSE_DOWN,this,this.scaleSmal),this.owner.on(Laya.Event.MOUSE_UP,this,this.scaleBig),this.owner.on(Laya.Event.MOUSE_OUT,this,this.scaleBig)},e.prototype.scaleBig=function(){Laya.Tween.to(this.owner,{scaleX:1,scaleY:1},this.scaleTime)},e.prototype.scaleSmal=function(){Laya.Tween.to(this.owner,{scaleX:.8,scaleY:.8},this.scaleTime)},e.prototype.onDestroy=function(){this.owner.off(Laya.Event.MOUSE_DOWN,this,this.scaleSmal),this.owner.off(Laya.Event.MOUSE_UP,this,this.scaleBig),this.owner.off(Laya.Event.MOUSE_OUT,this,this.scaleBig)},e}(Laya.Script);i.default=n},{}],55:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("./../ui/layaMaxUI"),a=t("../manager/GameStateManager"),o=t("../data/GameData"),r=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onAwake=function(){this.hero1.on(Laya.UIEvent.CLICK,this,this.clickHandler),this.hero2.on(Laya.UIEvent.CLICK,this,this.clickHandler),this.hero3.on(Laya.UIEvent.CLICK,this,this.clickHandler),this.hero4.on(Laya.UIEvent.CLICK,this,this.clickHandler)},e.prototype.clickHandler=function(t){switch(t.currentTarget){case this.hero1:o.GameData.instance.career=1;break;case this.hero2:o.GameData.instance.career=2;break;case this.hero3:o.GameData.instance.career=3;break;case this.hero4:o.GameData.instance.career=4}a.GameStateManager.Instance.changeGameState(3)},e.prototype.onDestroy=function(){this.hero1.off(Laya.UIEvent.CLICK,this,this.clickHandler),this.hero2.off(Laya.UIEvent.CLICK,this,this.clickHandler),this.hero3.off(Laya.UIEvent.CLICK,this,this.clickHandler),this.hero4.off(Laya.UIEvent.CLICK,this,this.clickHandler)},e}(n.ui.ui.SelectHeroSceneUI);i.default=r},{"../data/GameData":47,"../manager/GameStateManager":49,"./../ui/layaMaxUI":57}],56:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=t("../ui/layaMaxUI"),a=t("../data/GameData"),o=t("../utils/FilterUtil"),r=t("../config/ConfigManager"),s=t("../battle/BattleManager"),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onAwake=function(){var t=a.GameData.instance.rewards;this._cards?a.GameData.instance.clearCardArray(this._cards):this._cards=[];for(var e=0;e<t.cards.length;e++){var i=t.cards[e],o=a.CardIns.create();o.config=r.ConfigManager.Instance.card[i],this._cards.push(o)}var s=this.list_card;s.itemRender=n.ui.ui.CardRenderSkinUI,s.hScrollBarSkin="",s.selectEnable=!0,s.selectHandler=new Laya.Handler(this,this.onSelect),s.renderHandler=new Laya.Handler(this,this.updateItem),s.array=this._cards,this.btn_ok.on(Laya.Event.CLICK,this,this.clickHandler),this.btn_cancel.on(Laya.Event.CLICK,this,this.clickHandler)},e.prototype.updateItem=function(t,e){var i=this.list_card.array[e];i?(t.txt_desc.text=i.config.desc,t.txt_name.text=i.config.name,t.txt_mp.text=i.config.mp,e==this.list_card.selectedIndex?t.filters=[o.FilterUtil.FILTER_GREEN()]:t.filters=null,t.visible=!0):t.visible=!1},e.prototype.onSelect=function(t){this.list_card.refresh()},e.prototype.clickHandler=function(t){if(t.currentTarget==this.btn_ok){if(!(this.list_card.selectedIndex>=0&&this._cards[this.list_card.selectedIndex]))return;a.GameData.instance.getReward(this._cards[this.list_card.selectedIndex].config.id)}else t.currentTarget,this.btn_cancel;this.close(),s.BattleManager.Instance.destroyScene(),s.BattleManager.Instance.nextLevel()},e.prototype.onDestroy=function(){a.GameData.instance.clearCardArray(this._cards),this.btn_ok.off(Laya.Event.CLICK,this,this.clickHandler),this.btn_cancel.off(Laya.Event.CLICK,this,this.clickHandler)},e}(n.ui.ui.WinDialogSkinUI);i.WinDialog=l},{"../battle/BattleManager":3,"../config/ConfigManager":46,"../data/GameData":47,"../ui/layaMaxUI":57,"../utils/FilterUtil":58}],57:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=Laya.View,a=Laya.Dialog,o=Laya.Scene;!function(t){!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(e.uiView)},e.uiView={type:"Scene",props:{width:1136,runtime:"script/BattleScene.ts",height:640},compId:1,loadList:[],loadList3D:[]},e}(o);t.BattleSceneUI=e;var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(e.uiView)},e.uiView={type:"Scene",props:{width:1136,runtime:"script/GameUI.ts",positionVariance_0:100,maxPartices:100,height:640},compId:1,child:[{type:"Button",props:{width:200,var:"btn_1",top:200,skin:"comp/button.png",labelSize:20,label:"按钮",height:60,centerX:0},compId:20}],loadList:["comp/button.png"],loadList3D:[],components:[]},e}(o);t.TestSceneUI=i}(t.test||(t.test={}))}(i.ui||(i.ui={})),function(t){!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(e.uiView)},e.uiView={type:"View",props:{width:1136,runtime:"script/BattleUI.ts",height:640},compId:1,child:[{type:"Label",props:{y:524,x:76,var:"txt_mp",text:"label",styleSkin:"comp/label.png",fontSize:20,color:"#ffffff"},compId:6},{type:"Label",props:{y:524,x:20.6279296875,text:"水晶",styleSkin:"comp/label.png",fontSize:20,color:"#ffffff"},compId:7},{type:"Sprite",props:{y:14,x:18.8837890625,var:"group_othertime"},compId:10,child:[{type:"Sprite",props:{x:-.8837890625,width:255,texture:"common/recovery_fontBg0.png",height:46},compId:8},{type:"Label",props:{y:13,x:85.1162109375,var:"txt_level",text:"出牌阶段",styleSkin:"comp/label.png",fontSize:20,color:"#ffffff"},compId:9}],components:[]},{type:"Sprite",props:{y:544,x:722,var:"group_button"},compId:16,child:[{type:"Sprite",props:{y:30,x:79,visible:!1,var:"btn_send",texture:"common/commonbutton13_1.png",pivotY:30,pivotX:79},compId:12,child:[{type:"Script",props:{runtime:"script/ImageBtn.ts"},compId:20}],components:[]},{type:"Label",props:{y:17,x:56,visible:!1,text:"测试",styleSkin:"comp/label.png",mouseEnabled:!1,fontSize:20,color:"#ffffff"},compId:13},{type:"Sprite",props:{y:30,x:283,var:"btn_end",texture:"common/commonbutton13_1.png",pivotY:30,pivotX:79},compId:14,child:[{type:"Script",props:{runtime:"script/ImageBtn.ts"},compId:21}],components:[]},{type:"Label",props:{y:17,x:243,text:"结束回合",styleSkin:"comp/label.png",mouseEnabled:!1,fontSize:20,color:"#ffffff"},compId:15}],components:[]},{type:"Sprite",props:{y:472,x:858,var:"group_mytime"},compId:17,child:[{type:"Sprite",props:{x:-.8837890625,width:255,texture:"common/recovery_fontBg0.png",height:46},compId:18},{type:"Label",props:{y:13,x:85.1162109375,var:"txt_battleState",text:"出牌阶段",styleSkin:"comp/label.png",fontSize:20,color:"#ffffff"},compId:19}],components:[]},{type:"List",props:{y:471,x:169,width:531,var:"list_my",repeatY:1,height:153},compId:22},{type:"TextArea",props:{y:60,x:20.6279296875,width:181,var:"txt_console",vScrollBarSkin:"comp/vscroll.png",text:"console",skin:"comp/textarea.png",height:115,fontSize:16,editable:!1},compId:23},{type:"Label",props:{y:564,x:86,var:"txt_pile",text:"label",styleSkin:"comp/label.png",fontSize:20,color:"#ffffff"},compId:24},{type:"Label",props:{y:565,x:20,text:"发牌堆",styleSkin:"comp/label.png",fontSize:20,color:"#ffffff"},compId:25},{type:"Label",props:{y:586,x:86,var:"txt_discard",text:"label",styleSkin:"comp/label.png",fontSize:20,color:"#ffffff"},compId:26},{type:"Label",props:{y:586,x:20,text:"出牌堆",styleSkin:"comp/label.png",fontSize:20,color:"#ffffff"},compId:27},{type:"Label",props:{y:607,x:86,var:"txt_destroy",text:"label",styleSkin:"comp/label.png",fontSize:20,color:"#ffffff"},compId:28},{type:"Label",props:{y:607,x:19,text:"垃圾堆",styleSkin:"comp/label.png",fontSize:20,color:"#ffffff"},compId:29}],loadList:["comp/label.png","common/recovery_fontBg0.png","common/commonbutton13_1.png","comp/vscroll.png","comp/textarea.png"],loadList3D:[],components:[]},e}(n);t.BattleUISkinUI=e;var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(e.uiView)},e.uiView={type:"View",props:{width:104,height:143},compId:1,child:[{type:"Image",props:{y:16,x:0,width:104,skin:"common/bg_render.png",sizeGrid:"7,7,7,7",height:143},compId:3},{type:"Label",props:{y:24,x:1,width:98,var:"txt_name",text:"卡牌名",strokeColor:"#000000",stroke:1,height:17,color:"#ffffff",bold:!0,align:"center"},compId:4},{type:"Label",props:{y:93,x:2,wordWrap:!0,width:98,var:"txt_desc",valign:"middle",text:"卡牌描述卡牌描述卡牌描述卡牌描述卡牌描述卡牌描述卡牌描述卡牌描述",strokeColor:"#000000",stroke:1,leading:2,height:64,color:"#ffffff",align:"left"},compId:5},{type:"Label",props:{y:71.5,x:3,width:98,var:"txt_mp",text:"卡牌名",strokeColor:"#000000",stroke:1,height:17,color:"#ffffff",bold:!0,align:"center"},compId:7}],loadList:["common/bg_render.png"],loadList3D:[],components:[]},e}(n);t.CardRenderSkinUI=i;var r=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(e.uiView)},e.uiView={type:"Dialog",props:{width:500,height:300},compId:1,child:[{type:"Image",props:{y:0,x:10,width:480,skin:"common/tuozhanjiemian2.png",sizeGrid:"60,30,40,30",height:301},compId:8},{type:"Label",props:{y:130,x:140,text:"gg了，从头再来吧！菜鸡！",styleSkin:"comp/label.png",fontSize:20,color:"#ffffff"},compId:10},{type:"Image",props:{y:237,x:250,var:"btn_go",skin:"common/commonbutton11.png",pivotY:26,pivotX:54},compId:11,child:[{type:"Script",props:{runtime:"script/ImageBtn.ts"},compId:14}],components:[]},{type:"Label",props:{y:223,x:230,text:"取消",styleSkin:"comp/label.png",mouseThrough:!1,mouseEnabled:!1,fontSize:20,color:"#ffffff"},compId:12}],loadList:["common/tuozhanjiemian2.png","comp/label.png","common/commonbutton11.png"],loadList3D:[],components:[]},e}(a);t.GameOverDialogSkinUI=r;var s=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(e.uiView)},e.uiView={type:"View",props:{width:500,height:500},compId:1,child:[{type:"Label",props:{y:174,x:208,text:"帮助",styleSkin:"comp/label.png",fontSize:20,color:"#ffffff"},compId:2}],loadList:["comp/label.png"],loadList3D:[],components:[]},e}(n);t.HelpViewSkinUI=s;var l=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(e.uiView)},e.uiView={type:"Scene",props:{width:1136,runtime:"script/SelectHeroUI.ts",height:640},compId:1,child:[{type:"Sprite",props:{y:449,x:549,width:292,var:"hero3",texture:"img/choose1.png",pivotY:121,pivotX:145,height:246},compId:2,child:[{type:"Script",props:{runtime:"script/ImageBtn.ts"},compId:12}],components:[]},{type:"Sprite",props:{y:176,x:545,width:296,var:"hero2",texture:"img/choose2.png",pivotY:155,pivotX:147,height:307},compId:3,child:[{type:"Script",props:{runtime:"script/ImageBtn.ts"},compId:9}],components:[]},{type:"Sprite",props:{y:294.5,x:173,width:289,var:"hero1",texture:"img/choose4.png",pivotY:189,pivotX:144,height:377},compId:4,child:[{type:"Script",props:{runtime:"script/ImageBtn.ts"},compId:10}],components:[]},{type:"Sprite",props:{y:293,x:926,width:314,var:"hero4",texture:"img/choose3.png",pivotY:200,pivotX:157,height:402},compId:5,child:[{type:"Script",props:{runtime:"script/ImageBtn.ts"},compId:11}],components:[]}],loadList:["img/choose1.png","img/choose2.png","img/choose4.png","img/choose3.png"],loadList3D:[],components:[]},e}(o);t.SelectHeroSceneUI=l;var c=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(e.uiView)},e.uiView={type:"Dialog",props:{width:500,height:377},compId:1,child:[{type:"Image",props:{y:10,x:10,width:480,skin:"common/tuozhanjiemian2.png",sizeGrid:"60,30,40,30",height:363},compId:2},{type:"Label",props:{y:31,x:234.9951171875,text:"win",styleSkin:"comp/label.png",fontSize:20,color:"#ffffff"},compId:3},{type:"List",props:{y:121,x:43.5,width:413,var:"list_card",repeatY:1,height:153},compId:4},{type:"Image",props:{y:314,x:180,var:"btn_ok",skin:"common/commonbutton11.png",pivotY:26,pivotX:54},compId:5,child:[{type:"Script",props:{runtime:"script/ImageBtn.ts"},compId:9}],components:[]},{type:"Label",props:{y:300,x:160,text:"确定",styleSkin:"comp/label.png",mouseThrough:!1,mouseEnabled:!1,fontSize:20,color:"#ffffff"},compId:6},{type:"Image",props:{y:314,x:330,var:"btn_cancel",skin:"common/commonbutton11.png",pivotY:26,pivotX:54},compId:7,child:[{type:"Script",props:{runtime:"script/ImageBtn.ts"},compId:10}],components:[]},{type:"Label",props:{y:300,x:310,text:"取消",styleSkin:"comp/label.png",mouseThrough:!1,mouseEnabled:!1,fontSize:20,color:"#ffffff"},compId:8}],loadList:["common/tuozhanjiemian2.png","comp/label.png","common/commonbutton11.png"],loadList3D:[],components:[]},e}(a);t.WinDialogSkinUI=c}(t.ui||(t.ui={}))}(i.ui||(i.ui={}))},{}],58:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FilterUtil={FILTER_GRAY:function(){return new Laya.ColorFilter([.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0])},FILTER_HighLight:function(){return new Laya.ColorFilter([1,0,0,0,50,0,1,0,0,50,0,0,1,0,50,0,0,0,1,0])},FILTER_AN:function(){return new Laya.ColorFilter([.9,0,0,0,0,0,.9,0,0,0,0,0,.9,0,0,0,0,0,.9,0])},FILTER_RP:function(){return new Laya.ColorFilter([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},FILTER_GREEN:function(){return new Laya.ColorFilter([0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0])},FILTER_RED:function(){return new Laya.ColorFilter([1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0])},FILTER_MABI:function(){return new Laya.ColorFilter([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])}}},{}],59:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(t,e){this.max=0,this.pool=[],this.creater=t,this.max=e}return t.prototype.pop=function(){return this.pool.length>0?this.pool.pop():new this.creater},t.prototype.push=function(t){0==this.max||this.pool.length<this.max?(t.returnToPool(),this.pool.push(t)):t.disposePermanent()},t.prototype.has=function(t){for(var e=0,i=this.pool;e<i.length;e++){if(i[e]==t)return!0}return!1},t}();i.LimitedPool=n},{}],60:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function t(t,e){void 0===e&&(e=10),this.max=0,this.pool=[],this.creater=t;for(var i=0;i<e;i++)this.pool.push(new this.creater)}return t.prototype.pop=function(){return this.pool.length>0?this.pool.pop():new this.creater},t.prototype.push=function(t){this.pool.push(t)},t.prototype.has=function(t){for(var e=0,i=this.pool;e<i.length;e++){if(i[e]==t)return!0}return!1},t.prototype.clear=function(){this.pool=[]},t}();i.Pool=n},{}],61:[function(t,e,i){"use strict";function n(t){for(var e in t)i.hasOwnProperty(e)||(i[e]=t[e])}Object.defineProperty(i,"__esModule",{value:!0}),n(t("./Pool")),n(t("./LimitedPool"));!function(t){function e(t,e,i){for(var n=t.split(e,i),a=[],o=0,r=n.length;o<r;o++)a[o]=parseFloat(n[o]);return a}t.shuffle=function(t){for(var e=t.length,i=0;i<e;i++){var n=Math.floor(Math.random()*(e-i)),a=t[n];t[n]=t[e-i-1],t[e-i-1]=a}},t.shuffleClone=function(t,e){for(var i=t.length,n=e||[],a=0;a<i;a++)n[a]=t[a];for(a=0;a<i-1;a++){var o=Math.floor(Math.random()*(i-a)),r=n[o];n[o]=n[i-a-1],n[i-a-1]=r}return n},t.splitNumber=e,t.splitNumberTwoLevel=function(t,i,n,a){for(var o=t.split(i,a),r=[],s=0,l=o.length;s<l;s++)r[s]=e(o[s],n,a);return r}}(i.utils||(i.utils={}))},{"./LimitedPool":59,"./Pool":60}]},{},[2]);